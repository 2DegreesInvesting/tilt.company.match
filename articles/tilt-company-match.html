<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tilt.company.match">
<title>Matching companies • tilt.company.match</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Matching companies">
<meta property="og:description" content="tilt.company.match">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tilt.company.match</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/tilt-company-match.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/README_code.html">README (code)</a>
    <a class="dropdown-item" href="../articles/handling-large-loanbook.html">Handling a large loanbook</a>
    <a class="dropdown-item" href="../articles/standalone.html">Standalone (code)</a>
    <a class="dropdown-item" href="../articles/tilt-company-match_code.html">Get started (code)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Matching companies</h1>
            
      
      
      <div class="d-none name"><code>tilt-company-match.Rmd</code></div>
    </div>

    
    
<p>This document explains how to match companies in a loanbook from a
bank to companies in a tilt dataset from 2 Degrees Investing
Initiative.</p>
<div class="section level2">
<h2 id="considerations">Considerations<a class="anchor" aria-label="anchor" href="#considerations"></a>
</h2>
<ul>
<li>The company’s name may be different in each dataset, for example
because of typos.</li>
<li>The company’s country and postcode are useful. A match by name,
country, and postcode is more reliable than a match by name alone.</li>
<li>The company may not exist in the tilt dataset.</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-requirements">Data requirements<a class="anchor" aria-label="anchor" href="#data-requirements"></a>
</h2>
<p>Both your loanbook and tilt dataset must meet these requirements:</p>
<ul>
<li>It’s an R dataframe.</li>
<li>It has the columns <code>id</code>, <code>company_name</code>,
<code>postcode</code>, and <code>country</code>.</li>
<li>It may or may not have other columns.</li>
<li>The column <code>id</code> holds unique row-identifiers.</li>
</ul>
</div>
<div class="section level2">
<h2 id="system-requirements">System requirements<a class="anchor" aria-label="anchor" href="#system-requirements"></a>
</h2>
<ul>
<li>
<a href="https://happygitwithr.com/install-r-rstudio.html" class="external-link">Install R
and RStudio</a>.</li>
<li>
<a href="https://r-pkgs.org/setup.html#setup-tools" class="external-link">Setup an R build
toolchain</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="in-r-session-1">1. In R (session 1)<a class="anchor" aria-label="anchor" href="#in-r-session-1"></a>
</h2>
<p>In this first R session you’ll create a dataset with candidate
matches for the companies in your loanbook.</p>
<div class="section level3">
<h3 id="install-tilt-company-match">Install tilt.company.match<a class="anchor" aria-label="anchor" href="#install-tilt-company-match"></a>
</h3>
<p>You can install <a href="https://github.com/2DegreesInvesting/tilt.company.match" class="external-link">tilt.company.match</a>
from <a href="https://r-universe.dev/" class="external-link">r-universe</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://2degreesinvesting.r-universe.dev"</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tilt.company.match"</span><span class="op">)</span></span></code></pre></div>
<p>Or you can install it from <a href="https://github.com/" class="external-link">GitHub</a>
with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"2DegreesInvesting/tilt.company.match"</span><span class="op">)</span></span></code></pre></div>
<p>Call this function if things seem weird and you’re not sure what’s
wrong or how to fix it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">dev_sitrep</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-r-packages">Use R packages<a class="anchor" aria-label="anchor" href="#use-r-packages"></a>
</h3>
<p>Installing tilt.company.match should automatically install other
useful packages. You can use them all with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vroom.r-lib.org" class="external-link">vroom</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/markvanderloo/stringdist" class="external-link">stringdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/tilt.company.match/">tilt.company.match</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-the-datasets">Read the datasets<a class="anchor" aria-label="anchor" href="#read-the-datasets"></a>
</h3>
<p>This example uses “demo” datasets. You should use your real
<code>loanbook</code> and <code>tilt</code> datasets instead.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO: Replace with the path/to/your/real/loanbook.csv</span></span>
<span><span class="va">loanbook_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_file.html">example_file</a></span><span class="op">(</span><span class="st">"demo_loanbook.csv"</span><span class="op">)</span></span>
<span><span class="va">loanbook_csv</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/tilt.company.match/extdata/demo_loanbook.csv"</span></span>
<span></span>
<span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html" class="external-link">vroom</a></span><span class="op">(</span><span class="va">loanbook_csv</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">loanbook</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 5</span></span></span>
<span><span class="co">#&gt;       id company_name           postcode country misc_info</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasant Peter          01234    germany A        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Peasant Peter          01234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Peasant Peter          11234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Peasant Paul           01234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Bread Bakers Limited   23456    germany C        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Flower Power &amp; Company 34567    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Screwdriver Experts    45678    germany D        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Screwdriver Expert     45678    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 John Meier's Groceries 56789    germany E        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 John Meier's Groceries 55555    germany Y        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 John Meier's Groceries 55555    norway  Y        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 Best Bakers            65656    france  F</span></span>
<span></span>
<span><span class="co"># TODO: Replace with the path/to/your/real/tilt.csv</span></span>
<span><span class="va">tilt_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_file.html">example_file</a></span><span class="op">(</span><span class="st">"demo_tilt.csv"</span><span class="op">)</span></span>
<span><span class="va">tilt_csv</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/tilt.company.match/extdata/demo_tilt.csv"</span></span>
<span></span>
<span><span class="va">tilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html" class="external-link">vroom</a></span><span class="op">(</span><span class="va">tilt_csv</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">tilt</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 5</span></span></span>
<span><span class="co">#&gt;       id company_name                 postcode country misc_info</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasant Peter                01234    germany A        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Peasant Peter                01234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Peasant Peter                11234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Peasant Paul                 01234    germany B        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 The Bread Bakers Ltd         23456    germany C        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Flower Power Friends and Co. 34567    germany D        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Flower Power and Co.         34567    germany F        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 John and Jacques Groceries   56789    germany E        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 John and Jacques Groceries   98765    germany E        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 John and Jacques Groceries   98765    france  E        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 Cranes and Friends           65656    france  F</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-data-quality">Check data quality<a class="anchor" aria-label="anchor" href="#check-data-quality"></a>
</h3>
<p>Let’s first check you <code>loanbook</code> is as we expect.</p>
<div class="section level4">
<h4 id="expected-columns">Expected columns<a class="anchor" aria-label="anchor" href="#expected-columns"></a>
</h4>
<p>Do you have the expected columns <code>id</code>,
<code>company_name</code>, <code>postcode</code>, and
<code>country</code>?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"company_name"</span>, <span class="st">"postcode"</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span><span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/check_crucial_names.html">check_crucial_names</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Anything different throws an error</span></span>
<span><span class="va">bad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">loanbook</span>, ids <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="va">bad</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/check_crucial_names.html">check_crucial_names</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in abort_missing_names(sort(setdiff(expected_names, names(x)))) : </span></span>
<span><span class="co">#&gt;   Must have missing names:</span></span>
<span><span class="co">#&gt; `id`</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="duplicates">Duplicates<a class="anchor" aria-label="anchor" href="#duplicates"></a>
</h4>
<p>Do you have any duplicates in the column <code>id</code>?</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">has_no_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="va">loanbook</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="fl">0L</span><span class="op">)</span></span>
<span><span class="co"># If you get an error, remove the duplicates and try again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">has_no_duplicates</span><span class="op">)</span></span></code></pre></div>
<p>Do you have duplicates in <code>company_name</code>,
<code>postcode</code> or <code>country</code>?</p>
<p>It’s best if there is none. But if you find duplicates and they
belong to different companies, then you don’t have to fix them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_without_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"company_name"</span>, <span class="st">"postcode"</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/report_duplicates.html">report_duplicates</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">best_without_duplicates</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found duplicate(s) on columns company_name, postcode, country of the data set.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Found for the company Peasant Peter, postcode: 01234, country: germany</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Please check if these duplicates are intended and have an unique id.</span></span></code></pre></div>
<p>For example, here the column <code>misc_info</code> suggests the
duplicates belong to different companies, so it’s OK:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">company_name</span> <span class="op">==</span> <span class="st">"Peasant Peter"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">postcode</span> <span class="op">==</span> <span class="st">"01234"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;      id company_name  postcode country misc_info</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Peasant Peter 01234    germany A        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Peasant Peter 01234    germany Z</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="missing-values">Missing values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h4>
<p>Do you have missing values (<code>NA</code>s) in non-nullable
columns?</p>
<p>Non-nullable columns must not have missing values. If they do you
have to remove them. Missing values in other columns are fine.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_nullable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"company_name"</span><span class="op">)</span></span>
<span><span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span><span class="va">non_nullable</span><span class="op">)</span></span></code></pre></div>
<p>For example, here the non-nullable <code>id</code> column has one
missing value:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_loanbook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">id</span>, <span class="op">~</span><span class="va">company_name</span>, <span class="op">~</span><span class="va">postcode</span>, <span class="op">~</span><span class="va">country</span>, <span class="op">~</span><span class="va">misc_info</span>,</span>
<span>  <span class="cn">NA</span>, <span class="st">"John Meier's Groceries"</span>, <span class="st">"55555"</span>, <span class="st">"germany"</span>, <span class="st">"Y"</span>,</span>
<span>  <span class="fl">11</span>, <span class="st">"John Meier's Groceries"</span>, <span class="st">"55555"</span>, <span class="st">"norway"</span>, <span class="st">"Y"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bad_loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span><span class="va">non_nullable</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in abort_if_incomplete(., non_nullable) : </span></span>
<span><span class="co">#&gt;   Non-nullable columns must not have `NA`s.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Columns to review: id</span></span>
<span></span>
<span><span class="va">fixed_loanbook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">bad_loanbook</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># NA's are OK in columns other than non-nullable ones</span></span>
<span><span class="va">fixed_loanbook</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;      id company_name           postcode country misc_info</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    11 John Meier's Groceries 55555    norway  Y</span></span>
<span></span>
<span><span class="va">fixed_loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span><span class="va">non_nullable</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="create-a-standard-alias-of-company_name-in-both-datasets">Create a standard alias of <code>company_name</code> in both
datasets<a class="anchor" aria-label="anchor" href="#create-a-standard-alias-of-company_name-in-both-datasets"></a>
</h3>
<p>Use <code><a href="../reference/to_alias.html">to_alias()</a></code> to reduce the chance you’ll miss a match
because of spurious differences in the company name between the loanbook
and tilt dataset. This helps you get a less noisy, more consistent
version of <code>company_name</code> in each of the two datasets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook_alias</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>company_alias <span class="op">=</span> <span class="fu"><a href="../reference/to_alias.html">to_alias</a></span><span class="op">(</span><span class="va">company_name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">loanbook_alias</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 6</span></span></span>
<span><span class="co">#&gt;       id company_name           postcode country misc_info company_alias      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasant Peter          01234    germany A         peasantpeter       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Peasant Peter          01234    germany Z         peasantpeter       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Peasant Peter          11234    germany Z         peasantpeter       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Peasant Paul           01234    germany Z         peasantpaul        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Bread Bakers Limited   23456    germany C         breadbakers ltd    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Flower Power &amp; Company 34567    germany Z         flowerpower co     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Screwdriver Experts    45678    germany D         screwdriverexperts </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Screwdriver Expert     45678    germany Z         screwdriverexpert  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 John Meier's Groceries 56789    germany E         johnmeiersgroceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 John Meier's Groceries 55555    germany Y         johnmeiersgroceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 John Meier's Groceries 55555    norway  Y         johnmeiersgroceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 Best Bakers            65656    france  F         bestbakers</span></span>
<span></span>
<span><span class="va">tilt_alias</span> <span class="op">&lt;-</span> <span class="va">tilt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>company_alias <span class="op">=</span> <span class="fu"><a href="../reference/to_alias.html">to_alias</a></span><span class="op">(</span><span class="va">company_name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tilt_alias</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 6</span></span></span>
<span><span class="co">#&gt;       id company_name                 postcode country misc_info company_alias  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasant Peter                01234    germany A         peasantpeter   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Peasant Peter                01234    germany Z         peasantpeter   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Peasant Peter                11234    germany Z         peasantpeter   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Peasant Paul                 01234    germany B         peasantpaul    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 The Bread Bakers Ltd         23456    germany C         thebreadbakers…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Flower Power Friends and Co. 34567    germany D         flowerpowerfri…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Flower Power and Co.         34567    germany F         flowerpower co </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 John and Jacques Groceries   56789    germany E         johnjacquesgro…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 John and Jacques Groceries   98765    germany E         johnjacquesgro…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 John and Jacques Groceries   98765    france  E         johnjacquesgro…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 Cranes and Friends           65656    france  F         cranesfriends</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="match-candidates">Match candidates<a class="anchor" aria-label="anchor" href="#match-candidates"></a>
</h3>
<p>To inform the decision about which companies in your
<code>loanbook</code> match companies in the <code>tilt</code> dataset,
we compare the values in the columns <code>postcode</code> and
<code>country</code>:</p>
<ul>
<li>If your <code>loanbook</code> has both <code>postcode</code> and
<code>country</code> we match companies in that specific
<code>postcode</code> and that specific <code>country</code>. You will
likely match companies that are really the same (true positives) because
it’s unlikely that two companies with similar name will be located close
to each other. This will cost you the minimum amount of
manual-validation work ahead.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lacks_none</span> <span class="op">&lt;-</span> <span class="va">loanbook_alias</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">postcode</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">tilt_alias</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"postcode"</span><span class="op">)</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_tilt"</span><span class="op">)</span>,</span>
<span>    multiple <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<ul>
<li>If your <code>loanbook</code> lacks <code>postcode</code> but has
<code>country</code> we match companies in that specific
<code>country</code> but across every <code>postcode</code>. You will
possibly match companies that are not really the same (false positives)
but happen to have a similar name and are located in the same
<code>country</code>. This will cost you additional manual-validation
work ahead.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lacks_postcode</span> <span class="op">&lt;-</span> <span class="va">loanbook_alias</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">postcode</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">tilt_alias</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span><span class="op">)</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_tilt"</span><span class="op">)</span>,</span>
<span>    multiple <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<ul>
<li>If your <code>loanbook</code> has <code>postcode</code> but lacks
<code>country</code> we match companies with the same
<code>postcode</code> but across every <code>country</code>. You will
possibly match companies that are not really the same (false positives)
but happen to have a similar name and the same postcode. This will cost
you additional manual-validation work ahead.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lacks_country</span> <span class="op">&lt;-</span> <span class="va">loanbook_alias</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">postcode</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tilt_alias</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"postcode"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_tilt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>If your <code>loanbook</code> lacks both <code>postcode</code> and
<code>country</code> we match companies across the entire dataset. You
will most likely match companies that are not really the same (false
positives). This will cost you the greatest amount of additional
manual-validation work ahead.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lacks_both</span> <span class="op">&lt;-</span> <span class="va">loanbook_alias</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">postcode</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>postcode <span class="op">=</span> <span class="st">"join_helper"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">tilt_alias</span>, postcode <span class="op">=</span> <span class="st">"join_helper"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"postcode"</span><span class="op">)</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_tilt"</span><span class="op">)</span>,</span>
<span>    multiple <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>postcode <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span></span></code></pre></div>
<p>Having considered all cases, you can now combine them all in a single
dataset:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">lacks_none</span>, <span class="va">lacks_postcode</span>, <span class="va">lacks_country</span>, <span class="va">lacks_both</span><span class="op">)</span></span>
<span></span>
<span><span class="va">candidates</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 12</span></span></span>
<span><span class="co">#&gt;       id compa…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasan… 01234   germany A       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Peasan… 01234   germany A       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1 Peasan… 01234   germany A       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3 Peasan… 11234   germany Z       peasan…       3 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     4 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5 Bread … 23456   germany C       breadb…       5 The Br… C       thebre…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     6 Flower… 34567   germany Z       flower…       6 Flower… D       flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     6 Flower… 34567   germany Z       flower…       7 Flower… F       flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     7 Screwd… 45678   germany D       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     8 Screwd… 45678   germany Z       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     9 John M… 56789   germany E       johnme…       8 John a… E       johnja…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>    10 John M… 55555   germany Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>    11 John M… 55555   norway  Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>    12 Best B… 65656   france  F       bestba…      11 Cranes… F       cranes…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: postcode_tilt &lt;chr&gt;, country_tilt &lt;chr&gt;, and</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abbreviated variable names ¹​company_name, ²​postcode, ³​misc_info,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt, ⁷​company_alias_tilt</span></span></span></code></pre></div>
<p>Above each join allowed any one company in your <code>loanbook</code>
to match <code>"all"</code> of the potentially <code>multiple</code>
companies the <code>tilt</code> dataset. Here, for example, one company
in our demo <code>loanbook</code> matches three candidates in our demo
<code>tilt</code> dataset:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">company_alias</span>, <span class="va">id_tilt</span>, <span class="va">company_alias_tilt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   company_alias id_tilt company_alias_tilt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> peasantpeter        1 peasantpeter      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> peasantpeter        2 peasantpeter      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> peasantpeter        4 peasantpaul</span></span></code></pre></div>
<p>Next, calculate the string similarity between the aliased
<code>company_name</code> from the loanbook and tilt datasets. Complete
similarity corresponds to <code>1</code>, and complete dissimilarity
corresponds to <code>0</code>. For each company in the loanbook, arrange
matching candidates by descending similarity.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">okay_candidates</span> <span class="op">&lt;-</span> <span class="va">candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Other parameters may perform best. See `?stringdist::stringsim`</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>similarity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringsim</a></span><span class="op">(</span></span>
<span>    <span class="va">company_alias</span>, <span class="va">company_alias_tilt</span>,</span>
<span>    <span class="co"># Good to compare human typed text that might have typos.</span></span>
<span>    method <span class="op">=</span> <span class="st">"jw"</span>,</span>
<span>    p <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Arrange matching candidates from more to less similar</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="op">-</span><span class="va">similarity</span><span class="op">)</span></span>
<span></span>
<span><span class="va">okay_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 13</span></span></span>
<span><span class="co">#&gt;    simil…¹    id compa…² postc…³ country misc_…⁴ compa…⁵ id_tilt compa…⁶ misc_…⁷</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   1         1 Peasan… 01234   germany A       peasan…       1 Peasan… A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   1         1 Peasan… 01234   germany A       peasan…       2 Peasan… Z      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   0.879     1 Peasan… 01234   germany A       peasan…       4 Peasan… B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   1         2 Peasan… 01234   germany Z       peasan…       1 Peasan… A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   1         2 Peasan… 01234   germany Z       peasan…       2 Peasan… Z      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   0.879     2 Peasan… 01234   germany Z       peasan…       4 Peasan… B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   1         3 Peasan… 11234   germany Z       peasan…       3 Peasan… Z      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   1         4 Peasan… 01234   germany Z       peasan…       4 Peasan… B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   0.879     4 Peasan… 01234   germany Z       peasan…       1 Peasan… A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   0.879     4 Peasan… 01234   germany Z       peasan…       2 Peasan… Z      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>   0.844     5 Bread … 23456   germany C       breadb…       5 The Br… C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>   1         6 Flower… 34567   germany Z       flower…       7 Flower… F      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>   0.933     6 Flower… 34567   germany Z       flower…       6 Flower… D      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>  <span style="color: #BB0000;">NA</span>         7 Screwd… 45678   germany D       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>  <span style="color: #BB0000;">NA</span>         8 Screwd… 45678   germany Z       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>   0.848     9 John M… 56789   germany E       johnme…       8 John a… E      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>  <span style="color: #BB0000;">NA</span>        10 John M… 55555   germany Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>  <span style="color: #BB0000;">NA</span>        11 John M… 55555   norway  Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>   0.548    12 Best B… 65656   france  F       bestba…      11 Cranes… F      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: company_alias_tilt &lt;chr&gt;, postcode_tilt &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   country_tilt &lt;chr&gt;, and abbreviated variable names ¹​similarity,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​company_name, ³​postcode, ⁴​misc_info, ⁵​company_alias, ⁶​company_name_tilt,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁷​misc_info_tilt</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pick-best-candidates">Pick best candidates<a class="anchor" aria-label="anchor" href="#pick-best-candidates"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eligibility_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.75</span></span></code></pre></div>
<p>Empirically we found that candidates under a <code>similarity</code>
threshold of 0.75 are most likely false positives. Pick
<code>similarity</code> values above that threshold to drastically
reduce the number of candidates you’ll need to validate manually. We
believe this benefit outweighs the potential loss of a few true
positives.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_candidates</span> <span class="op">&lt;-</span> <span class="va">okay_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">similarity</span> <span class="op">&gt;</span> <span class="va">eligibility_threshold</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After picking the best candidates, some companies in your
<code>loanbook</code> might no longer have any candidate in the
<code>tilt</code> dataset.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unmatched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span></span>
<span>  <span class="va">okay_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">company_name</span><span class="op">)</span>,</span>
<span>  <span class="va">best_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">company_name</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id, company_name)`</span></span>
<span></span>
<span><span class="va">unmatched</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;      id company_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    12 Best Bakers</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="suggest-matches">Suggest matches<a class="anchor" aria-label="anchor" href="#suggest-matches"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Decided upon extensive experience</span></span>
<span><span class="va">suggestion_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span></code></pre></div>
<p>Later you’ll need to manually decide which of all candidates if any
is a true match. To make that job easier, we can automatically make some
suggestions in a new column <code>suggest_match</code>.</p>
<p>The values of <code>suggest_match</code> are set to <code>TRUE</code>
where the value of <code>similarity</code> meets all of these
conditions:</p>
<ul>
<li>It’s the highest among all other candidates.</li>
<li>It’s above a threshold of 0.9.</li>
<li>It’s the only such highest value in the group defined by a
combination of <code>company_name</code> x <code>postcode</code> – to
avoid duplicates.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates_suggest_match</span> <span class="op">&lt;-</span> <span class="va">best_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># - It's the highest among all other candidates.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">similarity</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># - It's above the threshold.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">similarity</span> <span class="op">&gt;</span> <span class="va">suggestion_threshold</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># - It's the only such highest value in the group defined by a combination of</span></span>
<span>  <span class="co"># `company_name` x `postcode` -- to avoid duplicates.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duplicates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="../reference/duplicated_paste.html">duplicated_paste</a></span><span class="op">(</span><span class="va">company_name</span>, <span class="va">postcode</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">duplicates</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id_tilt</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>suggest_match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In all other rows the value of <code>suggest_match</code> is
automatically set to <code>NA</code>. Also now create a new column
<code>accept_match</code> and fill it with <code>NA</code>. Later you’ll
edit this column.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">to_edit</span> <span class="op">&lt;-</span> <span class="va">best_candidates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">candidates_suggest_match</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"id_tilt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>accept_match <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">to_edit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">similarity</span>, <span class="va">suggest_match</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 15</span></span></span>
<span><span class="co">#&gt;    simil…¹ sugge…²    id compa…³ postc…⁴ country misc_…⁵ compa…⁶ id_tilt compa…⁷</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   1     <span style="color: #BB0000;">NA</span>          1 Peasan… 01234   germany A       peasan…       1 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   1     <span style="color: #BB0000;">NA</span>          1 Peasan… 01234   germany A       peasan…       2 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   0.879 <span style="color: #BB0000;">NA</span>          1 Peasan… 01234   germany A       peasan…       4 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   1     <span style="color: #BB0000;">NA</span>          2 Peasan… 01234   germany Z       peasan…       1 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   1     <span style="color: #BB0000;">NA</span>          2 Peasan… 01234   germany Z       peasan…       2 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   0.879 <span style="color: #BB0000;">NA</span>          2 Peasan… 01234   germany Z       peasan…       4 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   1     TRUE        3 Peasan… 11234   germany Z       peasan…       3 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   1     TRUE        4 Peasan… 01234   germany Z       peasan…       4 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   0.879 <span style="color: #BB0000;">NA</span>          4 Peasan… 01234   germany Z       peasan…       1 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   0.879 <span style="color: #BB0000;">NA</span>          4 Peasan… 01234   germany Z       peasan…       2 Peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>   0.844 <span style="color: #BB0000;">NA</span>          5 Bread … 23456   germany C       breadb…       5 The Br…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>   1     TRUE        6 Flower… 34567   germany Z       flower…       7 Flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>   0.933 <span style="color: #BB0000;">NA</span>          6 Flower… 34567   germany Z       flower…       6 Flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          7 Screwd… 45678   germany D       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          8 Screwd… 45678   germany Z       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>   0.848 <span style="color: #BB0000;">NA</span>          9 John M… 56789   germany E       johnme…       8 John a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         10 John M… 55555   germany Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         11 John M… 55555   norway  Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 5 more variables: misc_info_tilt &lt;chr&gt;, company_alias_tilt &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   postcode_tilt &lt;chr&gt;, country_tilt &lt;chr&gt;, accept_match &lt;lgl&gt;, and</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abbreviated variable names ¹​similarity, ²​suggest_match, ³​company_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​postcode, ⁵​misc_info, ⁶​company_alias, ⁷​company_name_tilt</span></span></span></code></pre></div>
<p>Note that even a <code>similarity</code> of <code>1</code> in the
same <code>postcode</code> can be a false positive. For example, this is
false positive:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">to_edit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">4</span>, <span class="va">id_tilt</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">suggest_match</span>, <span class="va">similarity</span>, <span class="va">postcode</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"misc_info"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   suggest_match similarity postcode misc_info misc_info_tilt</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE                   1 01234    Z         B</span></span></code></pre></div>
<p>Now write the dataset <code>to_edit</code> so that you can explore it
in a spreadsheet editor. For example, you may write it as a .csv or
.xlsx file then open it in Excel or GoogleSheets.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom_write.html" class="external-link">vroom_write</a></span><span class="op">(</span><span class="va">to_edit</span>, <span class="st">"to_edit.csv"</span>, delim <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or, you can install the writexl package with: `install.packages("writexl")`</span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu">write_xlsx</span><span class="op">(</span><span class="va">to_edit</span>, <span class="st">"to_edit.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="in-a-spreadsheet-editor">2. In a spreadsheet editor<a class="anchor" aria-label="anchor" href="#in-a-spreadsheet-editor"></a>
</h2>
<div class="section level3">
<h3 id="accept-or-reject-matches">Accept or reject matches<a class="anchor" aria-label="anchor" href="#accept-or-reject-matches"></a>
</h3>
<ul>
<li>Import the dataset <code>to_edit</code> into a spreadsheet editor
like Excel or GoogleSheets.</li>
<li>For each row decide if you want to reject or accept the suggested
match (<a href="https://docs.google.com/document/d/140t0YOaTbX0Vh4Fpay8y5pEJjXXPxXbupxjoyymimRc" class="external-link">manual
decision rules</a>). By default each row is rejected. To accept it type
TRUE in the column <code>accept_match</code>.</li>
<li>Save the edited file to later use it again in R, for example e.g. as
“edited.csv”.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="in-r-session-2">3. In R (session 2)<a class="anchor" aria-label="anchor" href="#in-r-session-2"></a>
</h2>
<div class="section level3">
<h3 id="use-r-packages-and-read-data">Use R packages and read data<a class="anchor" aria-label="anchor" href="#use-r-packages-and-read-data"></a>
</h3>
<p>Restart R to ensure nothing from the previous R session affects this
one.</p>
<p>Use the required packages for this section.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/tilt.company.match/">tilt.company.match</a></span><span class="op">)</span></span></code></pre></div>
<p>Read the “edited.csv” file, and again your loanbook.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO: Replace with the path/to/your/real/edited.csv</span></span>
<span><span class="va">edited_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_file.html">example_file</a></span><span class="op">(</span><span class="st">"demo_matched.csv"</span><span class="op">)</span></span>
<span><span class="va">edited_csv</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/tilt.company.match/extdata/demo_matched.csv"</span></span>
<span></span>
<span><span class="va">edited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html" class="external-link">vroom</a></span><span class="op">(</span><span class="va">edited_csv</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">edited</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 13</span></span></span>
<span><span class="co">#&gt;       id compa…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasan… 01234   germany A       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Peasan… 01234   germany A       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1 Peasan… 01234   germany A       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3 Peasan… 11234   germany Z       peasan…       3 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     4 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5 Bread … 23456   germany C       breadb…       5 The Br… C       thebre…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     6 Flower… 34567   germany Z       flower…       7 Flower… F       flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     6 Flower… 34567   germany Z       flower…       6 Flower… D       flower…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     7 Screwd… 45678   germany D       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     8 Screwd… 45678   germany Z       screwd…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     9 John M… 56789   germany E       johnme…       8 John a… E       johnja…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>    10 John M… 55555   germany Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>    11 John M… 55555   norway  Y       johnme…      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: string_sim &lt;dbl&gt;, suggest_match &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   accept_match &lt;lgl&gt;, and abbreviated variable names ¹​company_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁷​company_alias_tilt</span></span></span>
<span></span>
<span><span class="co"># TODO: Replace with the path/to/your/real/loanbook.csv</span></span>
<span><span class="va">loanbook_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_file.html">example_file</a></span><span class="op">(</span><span class="st">"demo_loanbook.csv"</span><span class="op">)</span></span>
<span><span class="va">loanbook_csv</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/tilt.company.match/extdata/demo_loanbook.csv"</span></span>
<span></span>
<span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html" class="external-link">vroom</a></span><span class="op">(</span><span class="va">loanbook_csv</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">loanbook</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 5</span></span></span>
<span><span class="co">#&gt;       id company_name           postcode country misc_info</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Peasant Peter          01234    germany A        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Peasant Peter          01234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Peasant Peter          11234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Peasant Paul           01234    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Bread Bakers Limited   23456    germany C        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Flower Power &amp; Company 34567    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Screwdriver Experts    45678    germany D        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Screwdriver Expert     45678    germany Z        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 John Meier's Groceries 56789    germany E        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 John Meier's Groceries 55555    germany Y        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 John Meier's Groceries 55555    norway  Y        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 Best Bakers            65656    france  F</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-the-edited-dataset">Check the edited dataset<a class="anchor" aria-label="anchor" href="#check-the-edited-dataset"></a>
</h3>
<p>Manual work is prone to errors. Check the edited dataset to ensure
it’s correct:</p>
<ul>
<li>Use <code><a href="../reference/pick_unmatched.html">pick_unmatched()</a></code> to explore companies in the
loanbook that didn’t match any company in the tilt dataset.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">not_matched</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/pick_unmatched.html">pick_unmatched</a></span><span class="op">(</span><span class="va">edited</span><span class="op">)</span></span>
<span><span class="va">not_matched</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;      id company_name          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     4 Peasant Paul          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     5 Bread Bakers Limited  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     7 Screwdriver Experts   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     8 Screwdriver Expert    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     9 John Meier's Groceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    10 John Meier's Groceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>    11 John Meier's Groceries</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>    12 Best Bakers</span></span></code></pre></div>
<ul>
<li>Use <code><a href="../reference/check_duplicated_relation.html">check_duplicated_relation()</a></code> to check if a company
from loanbook has been matched to more than one company from the tilt
dataset or reverse.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="va">edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/check_duplicated_relation.html">check_duplicated_relation</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; No duplicated matches found in the data.</span></span></code></pre></div>
<p>With bad data you get informative errors.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bad: A single loanbook-company can't match multiple tilt-companies</span></span>
<span><span class="va">bad_edited</span> <span class="op">&lt;-</span> <span class="va">edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>accept_match <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="cn">TRUE</span>, <span class="va">accept_match</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bad_edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#&gt;      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Peasant… 01234   germany A       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Peasant… 01234   germany A       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 Peasant… 01234   germany A       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 Peasant… 01234   germany Z       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2 Peasant… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2 Peasant… 01234   germany Z       peasan…       4 Peasan… B       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: string_sim &lt;dbl&gt;, suggest_match &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   accept_match &lt;lgl&gt;, and abbreviated variable names ¹​company_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁷​company_alias_tilt</span></span></span>
<span></span>
<span><span class="va">bad_edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/check_duplicated_relation.html">check_duplicated_relation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in check_duplicated_relation(.) : </span></span>
<span><span class="co">#&gt;   Duplicated match of company in loanbook detected.</span></span>
<span><span class="co">#&gt; Duplicated company name: Peasant Peter, id: 1.</span></span>
<span><span class="co">#&gt; Duplicated company name: Peasant Peter, id: 2.</span></span>
<span><span class="co">#&gt; Company names where `accept_match` is `TRUE` must be unique by `id`.</span></span>
<span><span class="co">#&gt; Have you ensured that only one tilt-id per loanbook-id is set to `TRUE`?</span></span>
<span></span>
<span><span class="co"># Bad: Multiple loanbook-companies can't match a single tilt-company</span></span>
<span><span class="va">bad_edited2</span> <span class="op">&lt;-</span> <span class="va">demo_matched</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_tilt</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">demo_matched</span><span class="op">)</span></span>
<span><span class="va">bad_edited2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">accept_match</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">id_tilt</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 13</span></span></span>
<span><span class="co">#&gt;      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    12 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     3 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: string_sim &lt;dbl&gt;, suggest_match &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   accept_match &lt;lgl&gt;, and abbreviated variable names ¹​company_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁷​company_alias_tilt</span></span></span>
<span></span>
<span><span class="va">bad_edited2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/check_duplicated_relation.html">check_duplicated_relation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in check_duplicated_relation(.) : </span></span>
<span><span class="co">#&gt;   Duplicated match of company from tilt db detected.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Duplicated tilt company name: Peasant Peter, tilt id: 3.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Have you ensured that each tilt-id is set to `TRUE` for maximum 1 company from the loanbook?</span></span></code></pre></div>
<p>If your edited dataset is wrong, go back to your spreadsheet editor
(i.e. repeat step 2), fix it, then check it again (i.e. repeat step
3).</p>
</div>
<div class="section level3">
<h3 id="pick-the-matching-companies">Pick the matching companies<a class="anchor" aria-label="anchor" href="#pick-the-matching-companies"></a>
</h3>
<p>Once your edited dataset is correct, pick the matching companies and
you’re done. Your final dataset will have as many rows as the number of
<code>TRUE</code> values in the <code>accept_match</code> columns of
your edited dataset.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">accept_match</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   accept_match     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE             4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>              14</span></span>
<span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="va">edited</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">accept_match</span><span class="op">)</span></span>
<span><span class="va">final</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 13</span></span></span>
<span><span class="co">#&gt;      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Peasant… 01234   germany A       peasan…       1 Peasan… A       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Peasant… 01234   germany Z       peasan…       2 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     6 Flower … 34567   germany Z       flower…       7 Flower… F       flower…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: string_sim &lt;dbl&gt;, suggest_match &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   accept_match &lt;lgl&gt;, and abbreviated variable names ¹​company_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁷​company_alias_tilt</span></span></span></code></pre></div>
<p>If you need to use your final dataset elsewhere, you may write it to
a .csv file like before with:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom_write.html" class="external-link">vroom_write</a></span><span class="op">(</span><span class="st">"final.csv"</span>, delim <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mirja Hollmann, Linda Delacombaz, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
