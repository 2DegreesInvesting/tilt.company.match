---
output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tilt.company.match

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![tilt.company.match status badge](https://2degreesinvesting.r-universe.dev/badges/tilt.company.match)](https://2degreesinvesting.r-universe.dev)
<!-- badges: end -->

The goal of tilt.company.match is to provide helpers for company name
matching in the tilt-project.

This document explains how to match companies in a loanbook from a bank to
companies in a tilt dataset from 2 Degrees Investing Initiative.

## Considerations

* The company's name may be different in each dataset, for example because of typos.
* The company's country and postcode are useful. A match by name, country, and postcode is more
reliable than a match by name alone.
* The company may not exist in the tilt dataset.

## Data requirements

Both your loanbook and tilt dataset must meet these requirements:

* It's an R dataframe.
* It has the columns `id`, `company_name`, `postcode`, and `country`.
* It may or may not have other columns.
* The column `id` holds unique row-identifiers.

## System requirements

* [Install R and RStudio](https://happygitwithr.com/install-r-rstudio.html).
* [Setup an R build toolchain](https://r-pkgs.org/setup.html#setup-tools).

## Installation

You can install
[tilt.company.match](https://github.com/2DegreesInvesting/tilt.company.match)
from [r-universe](https://r-universe.dev/) with:

```r
options(repos = c("https://2degreesinvesting.r-universe.dev", getOption("repos")))
install.packages("tilt.company.match")
```

Or you can install it from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("2DegreesInvesting/tilt.company.match")
```

Call this function if things seem weird and you're not sure what's wrong or how
to fix it.

```r
devtools::dev_sitrep()
```

## Usage

The entire process involves three steps:

1. Suggest matching candidates.
2. Accept or reject manually the matches suggested before.
3. Pick the matching companies.

Steps 1 and 3 involve code. You may copy-paste each code chunk or use our code
templates:

* You can get the code template for step 1 with:

```r
# install.packages("usethis")
usethis::use_template("suggest.Rmd", package = "tilt.company.match", open = TRUE)
```

* You can get the code template for step 2 with:

```r
usethis::use_template("pick.Rmd", package = "tilt.company.match", open = TRUE)
```

```{r echo=FALSE}
.match <- here::here("inst", "templates", "suggest.Rmd")
```

```{r child=.match}
```

### 2. Accept or reject

Here you'll accept or reject manually the matches suggested before, using a
spreadsheet editor like Excel or GoogleSheets:

* Import the dataset `to_edit` into a spreadsheet editor like Excel or GoogleSheets.
* For each row decide if you want to reject or accept the suggested match. To accept it type TRUE in the column `accept_match`. Else it'll be rejected.
* Save the edited file to later use it again in R, for example e.g. as "edited.csv".

```{r echo=FALSE}
.pick <- here::here("inst", "templates", "pick.Rmd")
```
```{r child=.pick}
```
