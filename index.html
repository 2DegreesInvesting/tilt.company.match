<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Package holds helpers for company matching in the
    tilt-project.  For details please refer to README.">
<title>Helpers for Company Name Matching in the tilt-Project • tilt.company.match</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Helpers for Company Name Matching in the tilt-Project">
<meta property="og:description" content="Package holds helpers for company matching in the
    tilt-project.  For details please refer to README.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">tilt.company.match</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/tilt-company-match.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="tiltcompanymatch">tilt.company.match<a class="anchor" aria-label="anchor" href="#tiltcompanymatch"></a>
</h1></div>
<p>The goal of tilt.company.match is to provide helpers for company name matching in the tilt-project,</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of tilt.company.match from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"2DegreesInvesting/tilt.company.match"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="matching-loanbooks-to-the-tilt-database">Matching loanbooks to the tilt database<a class="anchor" aria-label="anchor" href="#matching-loanbooks-to-the-tilt-database"></a>
</h2>
<p>The matching problem is characterised as follows:</p>
<ul>
<li><p>matching companies from banks` loanbooks to tilt will face problems of inconsistent company names (typos, conventions…)</p></li>
<li><p>postcode will be available as relatively reliable additional information</p></li>
<li><p>not all companies in loanbooks will be in tilt db (thus not have a match)</p></li>
</ul>
<p>To match the companies provided in a loanbook to companies in the tilt database we expect a loanbook dataframe and a tilt db dataframe that hold at least the columns <strong>company_name</strong>, <strong>postcode</strong> and <strong>country</strong> and a column <strong>id</strong> holding unique row identifiers. Further columns that educate decisions made by humans in the matching process may be present. For an example compare demo data below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/tilt.company.match/">tilt.company.match</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: stringdist</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">demo_loanbook</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="pre-matching-functions-to-check-the-data">Pre-matching functions to check the data<a class="anchor" aria-label="anchor" href="#pre-matching-functions-to-check-the-data"></a>
</h3>
<p>I order to run the matching process optimally, here are some useful functions to check your data before the matching process.</p>
<div class="section level4">
<h4 id="check-crucial-columns-names">Check crucial columns names<a class="anchor" aria-label="anchor" href="#check-crucial-columns-names"></a>
</h4>
<p>It is crucial to have the right columns’ names in your loanbook, exactly like in our demo_loanbook. Here is a function to check if your loanbook has the necessary names, which are declared under “crucial_names”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="va">demo_loanbook</span></span>
<span><span class="va">crucial_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"company_name"</span>, <span class="st">"postcode"</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/check_crucial_names.html">check_crucial_names</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">crucial_names</span><span class="op">)</span></span></code></pre></div>
<p>Now, let us rename the loanbook “country” column into “countries” and “company_name” into “Company Name”. If you un-comment (remove the hashtag) the line, it throws an error.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wrongly_named_loanbook</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    <span class="st">"countries"</span> <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>    <span class="st">"Company Name"</span> <span class="op">=</span> <span class="st">"company_name"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># un-comment this line to have the error</span></span>
<span><span class="co"># check_crucial_names(wrongly_named_loanbook, crucial_names)</span></span></code></pre></div>
<p>If you have an error in your loanbook, you can rename your loanbook columns, using the dplyr::rename() function, and perform a sanity check just after.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrected_loanbook</span> <span class="op">&lt;-</span> <span class="va">wrongly_named_loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    <span class="st">"country"</span> <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>    <span class="st">"company_name"</span> <span class="op">=</span> <span class="st">"Company Name"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/check_crucial_names.html">check_crucial_names</a></span><span class="op">(</span><span class="va">corrected_loanbook</span>, <span class="va">crucial_names</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="report-duplicates">Report duplicates<a class="anchor" aria-label="anchor" href="#report-duplicates"></a>
</h4>
<p>The function <strong>report_duplicates</strong> shows whether there are duplicates on some columns of interest. In this case, we strongly suggest duplicates on the <strong>company_name</strong>, <strong>postcode</strong> and <strong>country</strong> columns combination. We strongly encourage to use it on the loanbook data set.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="va">demo_loanbook</span></span>
<span><span class="va">columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"company_name"</span>, <span class="st">"postcode"</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/report_duplicates.html">report_duplicates</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">columns</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found duplicate(s) on columns company_name, postcode, country of the data set.</span></span>
<span><span class="co">#&gt; ✖ Found for the company Peasant Peter, postcode: 01234, country: germany</span></span>
<span><span class="co">#&gt; ℹ Please check if these duplicates are intended and have an unique id.</span></span></code></pre></div>
<p>Note: In our example we see, that while there are duplicate rows on columns company_name, postcode, country they seem to do belong to different companies so we do not need to fix this in our loanbook.</p>
</div>
<div class="section level4">
<h4 id="report-missing-values">Report missing values<a class="anchor" aria-label="anchor" href="#report-missing-values"></a>
</h4>
<p>Missing values or NAs should ideally not in the loanbook. The function <strong>abort_if_incomplete()</strong> checks how many NAs there are in each columns of the data set and report them to the user.</p>
<p>Here, the loanbook data set does not have any NAs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span><span class="va">demo_loanbook</span><span class="op">)</span></span></code></pre></div>
<p>There are some columns (currently <strong>id</strong> and <strong>company_name</strong>) on which we do not allow missings. In case there are missings on these columns report_missings() will throw an error. You then have to removed affected rows from your data. On other columns, e.g. <strong>postcode</strong> missings will be reported for information purposes. However they do not require action from user side.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># missings on a non-crucial column</span></span>
<span><span class="va">missing_non_crucial</span> <span class="op">&lt;-</span> <span class="va">demo_loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>postcode <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span>, <span class="cn">NA_character_</span>, <span class="va">.data</span><span class="op">$</span><span class="va">postcode</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing_non_crucial</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span>non_nullable_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"company_name"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># missings on a crucial column</span></span>
<span><span class="va">missing_crucial</span> <span class="op">&lt;-</span> <span class="va">demo_loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>company_name <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span>, <span class="cn">NA_character_</span>, <span class="va">.data</span><span class="op">$</span><span class="va">postcode</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing_crucial</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/abort_if_incomplete.html">abort_if_incomplete</a></span><span class="op">(</span>non_nullable_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"company_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `abort_if_incomplete()`:</span></span>
<span><span class="co">#&gt; ! Non-nullable columns must not have `NA`s.</span></span>
<span><span class="co">#&gt; ✖ Columns to review: company_name</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h3>
<p>In a first step, the company_names are preprocessed to reduce noise and increase consistency. To this end use a function called to_alias(). We assign the result of the preprocessing to a new column <strong>company_alias</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook</span> <span class="op">&lt;-</span> <span class="va">demo_loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>company_alias <span class="op">=</span> <span class="fu"><a href="reference/to_alias.html">to_alias</a></span><span class="op">(</span><span class="va">company_name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">loanbook</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="31%">
<col width="13%">
<col width="11%">
<col width="14%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">breadbakers ltd</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tilt</span> <span class="op">&lt;-</span> <span class="va">demo_tilt</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>company_alias <span class="op">=</span> <span class="fu"><a href="reference/to_alias.html">to_alias</a></span><span class="op">(</span><span class="va">company_name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tilt</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="34%">
<col width="11%">
<col width="10%">
<col width="12%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">The Bread Bakers Ltd</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">thebreadbakers ltd</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power Friends and Co.</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">D</td>
<td align="left">flowerpowerfriends co</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="deriving-candidates">Deriving Candidates<a class="anchor" aria-label="anchor" href="#deriving-candidates"></a>
</h3>
<p>To identify which entries from the tilt db match to the companies in the loanbook, we identify in a first step all companies with a matching country and postcode. This is based on the assumptions that postcodes are correct and stable.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook_with_candidates</span> <span class="op">&lt;-</span> <span class="va">loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tilt</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"postcode"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_tilt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in dplyr::left_join(., tilt, by = c("country", "postcode"), suffix = c("", : Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class="co">#&gt; ℹ Row 1 of `x` matches multiple rows.</span></span>
<span><span class="co">#&gt; ℹ If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class="co">#&gt;   warning.</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">loanbook_with_candidates</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="11%">
<col width="7%">
<col width="6%">
<col width="8%">
<col width="11%">
<col width="6%">
<col width="14%">
<col width="12%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
</tr>
</tbody>
</table>
<p>One can see that e.g. the company with the loanbook id 1 has 3 potential matches in the tilt db that have the same postcode (tilt id 1, 2, 4).</p>
<p>Next, we are calculating the string similarity between the aliased company name in the loanbook with the aliased company names in the tilt db in the same postcode and ordering by descending proximity. A complete similarity corresponds to 1, complete dissimilarity corresponds to 0. There are several string similarity metrics available with the <strong>stringdist</strong>-package. Depending on the nature and generation modality of the text different metrics perform best. For the current problem the Jaro-Winkler metric with a prefix factor of 0.1 is chosen. This metric tends to be suitable for comparing human typed text that might have typos.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook_with_candidates_and_dist</span> <span class="op">&lt;-</span> <span class="va">loanbook_with_candidates</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>string_sim <span class="op">=</span> <span class="fu">stringdist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringsim</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">company_alias</span>, b <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">company_alias_tilt</span>, method <span class="op">=</span> <span class="st">"jw"</span>, p <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="op">-</span><span class="va">string_sim</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">loanbook_with_candidates_and_dist</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="14%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="12%">
<col width="5%">
<col width="17%">
<col width="9%">
<col width="13%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">breadbakers ltd</td>
<td align="right">5</td>
<td align="left">The Bread Bakers Ltd</td>
<td align="left">C</td>
<td align="left">thebreadbakers ltd</td>
<td align="right">0.8444444</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">7</td>
<td align="left">Flower Power and Co.</td>
<td align="left">F</td>
<td align="left">flowerpower co</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">6</td>
<td align="left">Flower Power Friends and Co.</td>
<td align="left">D</td>
<td align="left">flowerpowerfriends co</td>
<td align="right">0.9333333</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Screwdriver Experts</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">D</td>
<td align="left">screwdriverexperts</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="left">Screwdriver Expert</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">screwdriverexpert</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">56789</td>
<td align="left">germany</td>
<td align="left">E</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">8</td>
<td align="left">John and Jacques Groceries</td>
<td align="left">E</td>
<td align="left">johnjacquesgroceries</td>
<td align="right">0.8478947</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">germany</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">norway</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="selecting-matches">Selecting matches<a class="anchor" aria-label="anchor" href="#selecting-matches"></a>
</h2>
<p>In order to make the work of a human working on the matching as easy as possible what can be automated should be automated. However correct matching is essential for the project success so incorrect matches, which cannot ultimately be ruled out when matching automatically are not acceptable. As a consequence for now the following workflow is suggested.</p>
<p>A human coder will have to inspect the data. It is advisable do to so in a spreadsheet application. A row is selected as match by setting column <strong>accept_match</strong> to TRUE. To support this the column <strong>suggest_match</strong> is provided.</p>
<p>The <strong>suggest_match</strong> column is set to TRUE if:</p>
<ul>
<li>The match is above a determined threshold.</li>
<li>It is the highest match of all matches.</li>
<li>There is only 1 highest match per <strong>company_name</strong> x <strong>id</strong> combination to avoid duplicates.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">highest_matches_per_company</span> <span class="op">&lt;-</span> <span class="va">loanbook_with_candidates_and_dist</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">string_sim</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">string_sim</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="co"># Threshold decided upon extensive experience with r2dii.match function and processes</span></span>
<span></span>
<span><span class="va">highest_matches_per_company_above_thresh</span> <span class="op">&lt;-</span> <span class="va">highest_matches_per_company</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">string_sim</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">)</span></span>
<span></span>
<span><span class="va">highest_matches_per_company_above_thresh_wo_duplicates</span> <span class="op">&lt;-</span> <span class="va">highest_matches_per_company_above_thresh</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duplicates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">company_name</span>, <span class="va">postcode</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">duplicates</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id_tilt</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>suggest_match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loanbook_with_candidates_and_dist_and_suggestion</span> <span class="op">&lt;-</span> <span class="va">loanbook_with_candidates_and_dist</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">highest_matches_per_company_above_thresh_wo_duplicates</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"id_tilt"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>accept_match <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">loanbook_with_candidates_and_dist_and_suggestion</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="2%">
<col width="12%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="10%">
<col width="4%">
<col width="15%">
<col width="8%">
<col width="11%">
<col width="6%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
<th align="left">suggest_match</th>
<th align="left">accept_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">breadbakers ltd</td>
<td align="right">5</td>
<td align="left">The Bread Bakers Ltd</td>
<td align="left">C</td>
<td align="left">thebreadbakers ltd</td>
<td align="right">0.8444444</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">7</td>
<td align="left">Flower Power and Co.</td>
<td align="left">F</td>
<td align="left">flowerpower co</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">6</td>
<td align="left">Flower Power Friends and Co.</td>
<td align="left">D</td>
<td align="left">flowerpowerfriends co</td>
<td align="right">0.9333333</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Screwdriver Experts</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">D</td>
<td align="left">screwdriverexperts</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="left">Screwdriver Expert</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">screwdriverexpert</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">56789</td>
<td align="left">germany</td>
<td align="left">E</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">8</td>
<td align="left">John and Jacques Groceries</td>
<td align="left">E</td>
<td align="left">johnjacquesgroceries</td>
<td align="right">0.8478947</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">germany</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">norway</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: even a match of 1 in the same postcode can in rare cases be a False positive, compare e.g. company 4 (“Peasant Paul”) in the example data.</p>
<div class="section level3">
<h3 id="check-matching-process">Check matching process<a class="anchor" aria-label="anchor" href="#check-matching-process"></a>
</h3>
<p>After having matched manually each companies, we can check for the companies that were not matched in the loanbook. This can be used as a ‘double-check’ to see if the two data sets were correctly manually matched. The demo-matched data set is an example of what the data set should look like after being manually checked: the <strong>accept_match</strong> column is now changed to TRUE or NA, depending on whether a company should be matched or not.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manually_matched</span> <span class="op">&lt;-</span> <span class="va">demo_matched</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">manually_matched</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="2%">
<col width="12%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="10%">
<col width="4%">
<col width="15%">
<col width="8%">
<col width="11%">
<col width="6%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
<th align="left">suggest_match</th>
<th align="left">accept_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">breadbakers ltd</td>
<td align="right">5</td>
<td align="left">The Bread Bakers Ltd</td>
<td align="left">C</td>
<td align="left">thebreadbakers ltd</td>
<td align="right">0.8444444</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">7</td>
<td align="left">Flower Power and Co.</td>
<td align="left">F</td>
<td align="left">flowerpower co</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">6</td>
<td align="left">Flower Power Friends and Co.</td>
<td align="left">D</td>
<td align="left">flowerpowerfriends co</td>
<td align="right">0.9333333</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Screwdriver Experts</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">D</td>
<td align="left">screwdriverexperts</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="left">Screwdriver Expert</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">screwdriverexpert</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">56789</td>
<td align="left">germany</td>
<td align="left">E</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">8</td>
<td align="left">John and Jacques Groceries</td>
<td align="left">E</td>
<td align="left">johnjacquesgroceries</td>
<td align="right">0.8478947</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">germany</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">norway</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="report-companies-with-no-matches">Report companies with no matches<a class="anchor" aria-label="anchor" href="#report-companies-with-no-matches"></a>
</h3>
<p>We can then use the <strong>report_no_matches</strong> function and determine companies in the loanbook for which no match was selected or found.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">not_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/report_no_matches.html">report_no_matches</a></span><span class="op">(</span><span class="va">loanbook</span>, <span class="va">manually_matched</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id, company_name, postcode, country, misc_info,</span></span>
<span><span class="co">#&gt; company_alias)`</span></span>
<span><span class="co">#&gt; Companies not matched in the loanbook by the tilt data set: Peasant Paul Bread</span></span>
<span><span class="co">#&gt; Bakers Limited Screwdriver Experts Screwdriver Expert John Meier's Groceries</span></span>
<span><span class="co">#&gt; John Meier's Groceries John Meier's Groceries ℹ Did you match these companies</span></span>
<span><span class="co">#&gt; manually correctly ?</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">not_matched</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">company_name</th>
<th align="right">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Peasant Paul</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Bread Bakers Limited</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Screwdriver Experts</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Screwdriver Expert</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">John Meier’s Groceries</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">John Meier’s Groceries</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">John Meier’s Groceries</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="report-duplicate-matches">Report duplicate matches<a class="anchor" aria-label="anchor" href="#report-duplicate-matches"></a>
</h3>
<p>To check some manual errors during the manual matching process, we can use the <strong>check_duplicated_relation</strong> function. It checks if a company from loanbook has been matched to &gt; 1 company from the tilt dataset or reverse.</p>
<p>Here, the demo_matched data set is hand-matched correctly: the column <strong>accept_match</strong> has been manually changed and verified.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manually_matched</span> <span class="op">&lt;-</span> <span class="va">demo_matched</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">manually_matched</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="2%">
<col width="12%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="10%">
<col width="4%">
<col width="15%">
<col width="8%">
<col width="11%">
<col width="6%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
<th align="left">suggest_match</th>
<th align="left">accept_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpaul</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Bread Bakers Limited</td>
<td align="left">23456</td>
<td align="left">germany</td>
<td align="left">C</td>
<td align="left">breadbakers ltd</td>
<td align="right">5</td>
<td align="left">The Bread Bakers Ltd</td>
<td align="left">C</td>
<td align="left">thebreadbakers ltd</td>
<td align="right">0.8444444</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">7</td>
<td align="left">Flower Power and Co.</td>
<td align="left">F</td>
<td align="left">flowerpower co</td>
<td align="right">1.0000000</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Flower Power &amp; Company</td>
<td align="left">34567</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">flowerpower co</td>
<td align="right">6</td>
<td align="left">Flower Power Friends and Co.</td>
<td align="left">D</td>
<td align="left">flowerpowerfriends co</td>
<td align="right">0.9333333</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Screwdriver Experts</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">D</td>
<td align="left">screwdriverexperts</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="left">Screwdriver Expert</td>
<td align="left">45678</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">screwdriverexpert</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">56789</td>
<td align="left">germany</td>
<td align="left">E</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">8</td>
<td align="left">John and Jacques Groceries</td>
<td align="left">E</td>
<td align="left">johnjacquesgroceries</td>
<td align="right">0.8478947</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">germany</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">John Meier’s Groceries</td>
<td align="left">55555</td>
<td align="left">norway</td>
<td align="left">Y</td>
<td align="left">johnmeiersgroceries</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The function does not throw an error and inform that no duplicates were found.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/check_duplicated_relation.html">check_duplicated_relation</a></span><span class="op">(</span><span class="va">manually_matched</span><span class="op">)</span></span>
<span><span class="co">#&gt; No duplicated matches found in the data.</span></span></code></pre></div>
<p>Now let us insert duplicated matches for the company with the ids 1 and 2.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duplicate_in_loanbook</span> <span class="op">&lt;-</span> <span class="va">manually_matched</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>accept_match <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="cn">TRUE</span>, <span class="va">accept_match</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">duplicate_in_loanbook</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="8%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="8%">
<col width="5%">
<col width="11%">
<col width="9%">
<col width="11%">
<col width="7%">
<col width="8%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
<th align="left">suggest_match</th>
<th align="left">accept_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">Peasant Peter</td>
<td align="left">A</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1.0000000</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Peasant Peter</td>
<td align="left">01234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">4</td>
<td align="left">Peasant Paul</td>
<td align="left">B</td>
<td align="left">peasantpaul</td>
<td align="right">0.8787879</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>The function then abort and throws an error with the lines of the duplicated rows.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># un-comment this line to have the error</span></span>
<span><span class="co"># check_duplicated_relation(duplicate_in_loanbook)</span></span></code></pre></div>
<p>Also, an error is thrown if we insert a duplicate match of a company from the tilt db to the loanbook.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duplicate_tilt_id_row</span> <span class="op">&lt;-</span> <span class="va">demo_matched</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_tilt</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">duplicate_tilt_id</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">demo_matched</span>, <span class="va">duplicate_tilt_id_row</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">duplicate_tilt_id</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">accept_match</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">id_tilt</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="8%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="8%">
<col width="5%">
<col width="11%">
<col width="9%">
<col width="11%">
<col width="7%">
<col width="8%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">company_name</th>
<th align="left">postcode</th>
<th align="left">country</th>
<th align="left">misc_info</th>
<th align="left">company_alias</th>
<th align="right">id_tilt</th>
<th align="left">company_name_tilt</th>
<th align="left">misc_info_tilt</th>
<th align="left">company_alias_tilt</th>
<th align="right">string_sim</th>
<th align="left">suggest_match</th>
<th align="left">accept_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">Peasant Peter</td>
<td align="left">11234</td>
<td align="left">germany</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">3</td>
<td align="left">Peasant Peter</td>
<td align="left">Z</td>
<td align="left">peasantpeter</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># un-comment this line to have the error</span></span>
<span><span class="co"># check_duplicated_relation(duplicate_tilt_id)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tilt.company.match</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Mirja Hollmann <br><small class="roles"> Author, maintainer </small>  </li>
<li>Linda Delacombaz <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mirja Hollmann, Linda Delacombaz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
