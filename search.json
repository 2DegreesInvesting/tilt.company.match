[{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"considerations","dir":"Articles","previous_headings":"","what":"Considerations","title":"tilt.company.match","text":"company’s name may different dataset, example typos. company’s country postcode useful. match name, country, postcode reliable match name alone. company may exist tilt dataset.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"data-requirements","dir":"Articles","previous_headings":"","what":"Data requirements","title":"tilt.company.match","text":"loanbook tilt dataset must meet requirements: ’s R dataframe. columns id, company_name, postcode, country. may may columns. column id holds unique row-identifiers.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"in-r-session-1","dir":"Articles","previous_headings":"","what":"1. In R (session 1)","title":"tilt.company.match","text":"first R session ’ll create dataset candidate matches companies loanbook.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"install-and-use-r-packages","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Install and use R packages","title":"tilt.company.match","text":"need package tilt.company.match. can install GitHub : ’ll also use packages dplyr stringdist install automatically tilt.company.match. can use :","code":"# install.packages(\"devtools\") devtools::install_github(\"2DegreesInvesting/tilt.company.match\") library(dplyr, warn.conflicts = FALSE) library(stringdist) library(tilt.company.match)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"read-the-datasets","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Read the datasets","title":"tilt.company.match","text":"example uses “demo” loanbook. use real loanbook instead","code":"# If you don't have the readr package you can install it with # install.packages(\"readr\")  # TODO: Use your real loanbook with something like: # loanbook <- readr::read_csv(\"path/to/your/real/loanbook.csv\") loanbook <- demo_loanbook loanbook #> # A tibble: 12 × 5 #>       id company_name           postcode country misc_info #>    <dbl> <chr>                  <chr>    <chr>   <chr>     #>  1     1 Peasant Peter          01234    germany A         #>  2     2 Peasant Peter          01234    germany Z         #>  3     3 Peasant Peter          11234    germany Z         #>  4     4 Peasant Paul           01234    germany Z         #>  5     5 Bread Bakers Limited   23456    germany C         #>  6     6 Flower Power & Company 34567    germany Z         #>  7     7 Screwdriver Experts    45678    germany D         #>  8     8 Screwdriver Expert     45678    germany Z         #>  9     9 John Meier's Groceries 56789    germany E         #> 10    10 John Meier's Groceries 55555    germany Y         #> 11    11 John Meier's Groceries 55555    norway  Y         #> 12    12 Best Bakers            65656    france  F  # TODO: Use your real tilt dataset with something like: # tilt <- readr::read_csv(\"path/to/your/real/tilt.csv\") tilt <- demo_tilt tilt #> # A tibble: 11 × 5 #>       id company_name                 postcode country misc_info #>    <dbl> <chr>                        <chr>    <chr>   <chr>     #>  1     1 Peasant Peter                01234    germany A         #>  2     2 Peasant Peter                01234    germany Z         #>  3     3 Peasant Peter                11234    germany Z         #>  4     4 Peasant Paul                 01234    germany B         #>  5     5 The Bread Bakers Ltd         23456    germany C         #>  6     6 Flower Power Friends and Co. 34567    germany D         #>  7     7 Flower Power and Co.         34567    germany F         #>  8     8 John and Jacques Groceries   56789    germany E         #>  9     9 John and Jacques Groceries   98765    germany E         #> 10    10 John and Jacques Groceries   98765    france  E         #> 11    11 Cranes and Friends           65656    france  F"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"check-data-quality","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Check data quality","title":"tilt.company.match","text":"Let’s first check loanbook expect.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"expected-columns","dir":"Articles","previous_headings":"1. In R (session 1) > Check data quality","what":"Expected columns","title":"tilt.company.match","text":"expected columns id, company_name, postcode, country?","code":"expected <- c(\"id\", \"company_name\", \"postcode\", \"country\") loanbook %>% check_crucial_names(expected)  # Anything different throws an error bad <- rename(loanbook, ids = id) bad %>% check_crucial_names(expected) %>% try() #> Error in abort_missing_names(sort(setdiff(expected_names, names(x)))) :  #>   Must have missing names: #> `id`"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"duplicates","dir":"Articles","previous_headings":"1. In R (session 1) > Check data quality","what":"Duplicates","title":"tilt.company.match","text":"duplicates column id? duplicates company_name, postcode country? ’s best none. find duplicates belong different companies, don’t fix . example, column misc_info suggests duplicates belong different companies, ’s OK:","code":"has_no_duplicates <- identical(anyDuplicated(demo_loanbook$id), 0L) # If you get an error, remove the duplicates and try again stopifnot(has_no_duplicates) best_without_duplicates <- c(\"company_name\", \"postcode\", \"country\") report_duplicates(loanbook, best_without_duplicates) #> Found duplicate(s) on columns company_name, postcode, country of the data set. #> ✖ Found for the company Peasant Peter, postcode: 01234, country: germany #> ℹ Please check if these duplicates are intended and have an unique id. loanbook %>%    filter(company_name == \"Peasant Peter\") %>%    filter(postcode == \"01234\") #> # A tibble: 2 × 5 #>      id company_name  postcode country misc_info #>   <dbl> <chr>         <chr>    <chr>   <chr>     #> 1     1 Peasant Peter 01234    germany A         #> 2     2 Peasant Peter 01234    germany Z"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"missing-values","dir":"Articles","previous_headings":"1. In R (session 1) > Check data quality","what":"Missing values","title":"tilt.company.match","text":"missing values (NAs) non-nullable columns? Non-nullable columns must missing values. remove . Missing values columns fine. example, non-nullable id column one missing value:","code":"non_nullable <- c(\"id\", \"company_name\") loanbook %>% abort_if_incomplete(non_nullable) bad_loanbook <- tribble(   ~id,             ~company_name, ~postcode,  ~country, ~misc_info,    NA,  \"John Meier's Groceries\",   \"55555\", \"germany\",        \"Y\",    11,  \"John Meier's Groceries\",   \"55555\",  \"norway\",        \"Y\"   ) bad_loanbook %>% abort_if_incomplete(non_nullable) %>% try() #> Error in abort_if_incomplete(., non_nullable) :  #>   Non-nullable columns must not have `NA`s. #> ✖ Columns to review: id  fixed_loanbook <- filter(bad_loanbook, !is.na(id)) # NA's are OK in columns other than non-nullable ones fixed_loanbook #> # A tibble: 1 × 5 #>      id company_name           postcode country misc_info #>   <dbl> <chr>                  <chr>    <chr>   <chr>     #> 1    11 John Meier's Groceries 55555    norway  Y  fixed_loanbook %>% abort_if_incomplete(non_nullable)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"create-a-standard-alias-of-company_name-in-both-datasets","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Create a standard alias of company_name in both datasets","title":"tilt.company.match","text":"Use to_alias() reduce chance ’ll miss match spurious differences company name loanbook tilt dataset. helps get less noisy, consistent version company_name two datasets.","code":"loanbook_alias <- loanbook %>% mutate(company_alias = to_alias(company_name)) loanbook_alias #> # A tibble: 12 × 6 #>       id company_name           postcode country misc_info company_alias       #>    <dbl> <chr>                  <chr>    <chr>   <chr>     <chr>               #>  1     1 Peasant Peter          01234    germany A         peasantpeter        #>  2     2 Peasant Peter          01234    germany Z         peasantpeter        #>  3     3 Peasant Peter          11234    germany Z         peasantpeter        #>  4     4 Peasant Paul           01234    germany Z         peasantpaul         #>  5     5 Bread Bakers Limited   23456    germany C         breadbakers ltd     #>  6     6 Flower Power & Company 34567    germany Z         flowerpower co      #>  7     7 Screwdriver Experts    45678    germany D         screwdriverexperts  #>  8     8 Screwdriver Expert     45678    germany Z         screwdriverexpert   #>  9     9 John Meier's Groceries 56789    germany E         johnmeiersgroceries #> 10    10 John Meier's Groceries 55555    germany Y         johnmeiersgroceries #> 11    11 John Meier's Groceries 55555    norway  Y         johnmeiersgroceries #> 12    12 Best Bakers            65656    france  F         bestbakers  tilt_alias <- tilt %>% mutate(company_alias = to_alias(company_name)) tilt_alias #> # A tibble: 11 × 6 #>       id company_name                 postcode country misc_info company_alias   #>    <dbl> <chr>                        <chr>    <chr>   <chr>     <chr>           #>  1     1 Peasant Peter                01234    germany A         peasantpeter    #>  2     2 Peasant Peter                01234    germany Z         peasantpeter    #>  3     3 Peasant Peter                11234    germany Z         peasantpeter    #>  4     4 Peasant Paul                 01234    germany B         peasantpaul     #>  5     5 The Bread Bakers Ltd         23456    germany C         thebreadbakers… #>  6     6 Flower Power Friends and Co. 34567    germany D         flowerpowerfri… #>  7     7 Flower Power and Co.         34567    germany F         flowerpower co  #>  8     8 John and Jacques Groceries   56789    germany E         johnjacquesgro… #>  9     9 John and Jacques Groceries   98765    germany E         johnjacquesgro… #> 10    10 John and Jacques Groceries   98765    france  E         johnjacquesgro… #> 11    11 Cranes and Friends           65656    france  F         cranesfriends"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"match-candidates","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Match candidates","title":"tilt.company.match","text":"identify matching candidates, join two datasets allowing one company loanbook match \"\" potentially multiple companies country postcode. example, one company loanbook matches three candidates tilt dataset: Next, calculate string similarity aliased company_name loanbook tilt datasets. Complete similarity corresponds 1, complete dissimilarity corresponds 0. company loanbook, arrange matching candidates descending similarity.","code":"candidates <- left_join(     loanbook_alias, tilt_alias,      by = c(\"country\", \"postcode\"),     # Add the suffix \"_tilt\" to each column from the tilt dataset     suffix = c(\"\", \"_tilt\"),     # Allow matching each company in loanbook to many companies in tilt     multiple = \"all\" ) candidates %>%    filter(id == 1) %>%   select(company_alias, id_tilt, company_alias_tilt) #> # A tibble: 3 × 3 #>   company_alias id_tilt company_alias_tilt #>   <chr>           <dbl> <chr>              #> 1 peasantpeter        1 peasantpeter       #> 2 peasantpeter        2 peasantpeter       #> 3 peasantpeter        4 peasantpaul okay_candidates <- candidates %>%   # Other parameters may perform best. See `?stringdist::stringsim`   mutate(similarity = stringsim(     company_alias, company_alias_tilt,      # Good to compare human typed text that might have typos.     method = \"jw\",      p = 0.1   )) %>%    # Arrange matching candidates from more to less similar   arrange(id, -similarity)  okay_candidates %>% relocate(similarity) #> # A tibble: 19 × 11 #>    simil…¹    id compa…² postc…³ country misc_…⁴ compa…⁵ id_tilt compa…⁶ misc_…⁷ #>      <dbl> <dbl> <chr>   <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   <chr>   #>  1   1         1 Peasan… 01234   germany A       peasan…       1 Peasan… A       #>  2   1         1 Peasan… 01234   germany A       peasan…       2 Peasan… Z       #>  3   0.879     1 Peasan… 01234   germany A       peasan…       4 Peasan… B       #>  4   1         2 Peasan… 01234   germany Z       peasan…       1 Peasan… A       #>  5   1         2 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       #>  6   0.879     2 Peasan… 01234   germany Z       peasan…       4 Peasan… B       #>  7   1         3 Peasan… 11234   germany Z       peasan…       3 Peasan… Z       #>  8   1         4 Peasan… 01234   germany Z       peasan…       4 Peasan… B       #>  9   0.879     4 Peasan… 01234   germany Z       peasan…       1 Peasan… A       #> 10   0.879     4 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       #> 11   0.844     5 Bread … 23456   germany C       breadb…       5 The Br… C       #> 12   1         6 Flower… 34567   germany Z       flower…       7 Flower… F       #> 13   0.933     6 Flower… 34567   germany Z       flower…       6 Flower… D       #> 14  NA         7 Screwd… 45678   germany D       screwd…      NA NA      NA      #> 15  NA         8 Screwd… 45678   germany Z       screwd…      NA NA      NA      #> 16   0.848     9 John M… 56789   germany E       johnme…       8 John a… E       #> 17  NA        10 John M… 55555   germany Y       johnme…      NA NA      NA      #> 18  NA        11 John M… 55555   norway  Y       johnme…      NA NA      NA      #> 19   0.548    12 Best B… 65656   france  F       bestba…      11 Cranes… F       #> # … with 1 more variable: company_alias_tilt <chr>, and abbreviated variable #> #   names ¹​similarity, ²​company_name, ³​postcode, ⁴​misc_info, ⁵​company_alias, #> #   ⁶​company_name_tilt, ⁷​misc_info_tilt"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"pick-best-candidates","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Pick best candidates","title":"tilt.company.match","text":"Empirically found candidates similarity threshold 0.75 false positives. Pick similarity values threshold drastically reduce number candidates ’ll need validate manually. believe benefit outweighs potential loss true positives. picking best candidates, companies loanbook might longer candidate tilt dataset.","code":"eligibility_threshold <- 0.75 best_candidates <- okay_candidates %>%    filter(similarity > eligibility_threshold | is.na(similarity)) unmatched <- anti_join(   okay_candidates %>% distinct(id, company_name),   best_candidates %>% distinct(id, company_name) ) #> Joining with `by = join_by(id, company_name)`  unmatched #> # A tibble: 1 × 2 #>      id company_name #>   <dbl> <chr>        #> 1    12 Best Bakers"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"suggest-matches","dir":"Articles","previous_headings":"1. In R (session 1)","what":"Suggest matches","title":"tilt.company.match","text":"Later ’ll need manually decide candidates true match. make job easier, can automatically make suggestions new column suggest_match. values suggest_match set TRUE value similarity meets conditions: ’s highest among candidates. ’s threshold 0.9. ’s highest value group defined combination company_name x postcode – avoid duplicates. rows value suggest_match automatically set NA. Also now create new column accept_match fill NA. Later ’ll edit colum. Note even similarity 1 postcode can false positive. example, false positive: Now write dataset to_edit can explore spreadsheet editor. example, may write .csv .xlsx open Excel GoogleSheets.","code":"# Decided upon extensive experience suggestion_threshold <- 0.9 candidates_suggest_match <- best_candidates %>%   # - It's the highest among all other candidates.   group_by(id) %>%   filter(similarity == max(similarity)) %>%    # - It's above the threshold.   filter(similarity > suggestion_threshold) %>%    # - It's the only such highest value in the group defined by a combination of   # `company_name` x `postcode` -- to avoid duplicates.   mutate(duplicates = any(duplicated(paste(company_name, postcode)))) %>%   filter(!duplicates) %>%   select(id, id_tilt) %>%   mutate(suggest_match = TRUE) %>%    ungroup() to_edit <- best_candidates %>%   left_join(candidates_suggest_match, by = c(\"id\", \"id_tilt\")) %>%   mutate(accept_match = NA)  to_edit %>% relocate(similarity, suggest_match) #> # A tibble: 18 × 13 #>    simil…¹ sugge…²    id compa…³ postc…⁴ country misc_…⁵ compa…⁶ id_tilt compa…⁷ #>      <dbl> <lgl>   <dbl> <chr>   <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   #>  1   1     NA          1 Peasan… 01234   germany A       peasan…       1 Peasan… #>  2   1     NA          1 Peasan… 01234   germany A       peasan…       2 Peasan… #>  3   0.879 NA          1 Peasan… 01234   germany A       peasan…       4 Peasan… #>  4   1     NA          2 Peasan… 01234   germany Z       peasan…       1 Peasan… #>  5   1     NA          2 Peasan… 01234   germany Z       peasan…       2 Peasan… #>  6   0.879 NA          2 Peasan… 01234   germany Z       peasan…       4 Peasan… #>  7   1     TRUE        3 Peasan… 11234   germany Z       peasan…       3 Peasan… #>  8   1     TRUE        4 Peasan… 01234   germany Z       peasan…       4 Peasan… #>  9   0.879 NA          4 Peasan… 01234   germany Z       peasan…       1 Peasan… #> 10   0.879 NA          4 Peasan… 01234   germany Z       peasan…       2 Peasan… #> 11   0.844 NA          5 Bread … 23456   germany C       breadb…       5 The Br… #> 12   1     TRUE        6 Flower… 34567   germany Z       flower…       7 Flower… #> 13   0.933 NA          6 Flower… 34567   germany Z       flower…       6 Flower… #> 14  NA     NA          7 Screwd… 45678   germany D       screwd…      NA NA      #> 15  NA     NA          8 Screwd… 45678   germany Z       screwd…      NA NA      #> 16   0.848 NA          9 John M… 56789   germany E       johnme…       8 John a… #> 17  NA     NA         10 John M… 55555   germany Y       johnme…      NA NA      #> 18  NA     NA         11 John M… 55555   norway  Y       johnme…      NA NA      #> # … with 3 more variables: misc_info_tilt <chr>, company_alias_tilt <chr>, #> #   accept_match <lgl>, and abbreviated variable names ¹​similarity, #> #   ²​suggest_match, ³​company_name, ⁴​postcode, ⁵​misc_info, ⁶​company_alias, #> #   ⁷​company_name_tilt to_edit %>%    filter(id == 4, id_tilt == 4) %>%   select(suggest_match, similarity, postcode, matches(\"misc_info\")) #> # A tibble: 1 × 5 #>   suggest_match similarity postcode misc_info misc_info_tilt #>   <lgl>              <dbl> <chr>    <chr>     <chr>          #> 1 TRUE                   1 01234    Z         B # You can install the readr package with: `install.packages(\"readr\")` readr::write_csv(to_edit, \"to_edit.csv\")  # Or, you can install the writexl package with: `install.packages(\"writexl\")` writexl::write_xlsx(to_edit, \"to_edit.xlsx\")"},{"path":[]},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"accept-or-reject-matches","dir":"Articles","previous_headings":"2. In a spreadsheet editor","what":"Accept or reject matches","title":"tilt.company.match","text":"Import dataset to_edit spreadsheet editor like Excel GoogleSheets. row decide want reject accept suggested match. default row rejected. accept type TRUE column accept_match. Save edited file later use R, example e.g. “edited.csv”.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"use-r-packages-and-read-data","dir":"Articles","previous_headings":"3. In R (session 2)","what":"Use R packages and read data","title":"tilt.company.match","text":"Restart R ensure nothing previous R session affects one. Use required packages section. Read “edited.csv” file, lookbook.","code":"library(dplyr, warn.conflicts = FALSE) library(tilt.company.match) # TODO: Use your real edited dataset with something like: # edited <- readr::read_csv(\"path/to/the/file/you/really/edited.csv\") edited <- demo_matched  # TODO: Use your real loanbook with something like: # loanbook <- readr::read_csv(\"path/to/your/real/loanbook.csv\") loanbook <- demo_loanbook"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"check-the-edited-dataset","dir":"Articles","previous_headings":"3. In R (session 2)","what":"Check the edited dataset","title":"tilt.company.match","text":"Manual work prone errors. Check edited dataset ensure ’s correct: Use report_no_matches() explore companies loanbook didn’t match company tilt dataset. Use check_duplicated_relation() check company loanbook matched one company tilt dataset reverse. bad data get informative errors. edited dataset wrong, go back spreadsheet editor (.e. repeat step 2), fix , check (.e. repeat step 3).","code":"not_matched <- loanbook %>% report_no_matches(edited) #> Joining with `by = join_by(id, company_name, postcode, country, misc_info)` #> Companies not matched in the loanbook by the tilt data set: Peasant Paul Bread #> Bakers Limited Screwdriver Experts Screwdriver Expert John Meier's Groceries #> John Meier's Groceries John Meier's Groceries Best Bakers ℹ Did you match these #> companies manually correctly ? not_matched #> # A tibble: 8 × 2 #>   company_name              id #>   <chr>                  <dbl> #> 1 Peasant Paul               4 #> 2 Bread Bakers Limited       5 #> 3 Screwdriver Experts        7 #> 4 Screwdriver Expert         8 #> 5 John Meier's Groceries     9 #> 6 John Meier's Groceries    10 #> 7 John Meier's Groceries    11 #> 8 Best Bakers               12 # Good edited %>% check_duplicated_relation() #> No duplicated matches found in the data. # Bad: A single loanbook-company can't match multiple tilt-companies bad_edited <- edited %>%   mutate(accept_match = if_else(id %in% c(1, 2), TRUE, accept_match)) bad_edited %>% filter(id %in% c(1, 2)) #> # A tibble: 6 × 13 #>      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷ #>   <dbl> <chr>    <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   <chr>   <chr>   #> 1     1 Peasant… 01234   germany A       peasan…       1 Peasan… A       peasan… #> 2     1 Peasant… 01234   germany A       peasan…       2 Peasan… Z       peasan… #> 3     1 Peasant… 01234   germany A       peasan…       4 Peasan… B       peasan… #> 4     2 Peasant… 01234   germany Z       peasan…       1 Peasan… A       peasan… #> 5     2 Peasant… 01234   germany Z       peasan…       2 Peasan… Z       peasan… #> 6     2 Peasant… 01234   germany Z       peasan…       4 Peasan… B       peasan… #> # … with 3 more variables: string_sim <dbl>, suggest_match <lgl>, #> #   accept_match <lgl>, and abbreviated variable names ¹​company_name, #> #   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt, #> #   ⁷​company_alias_tilt  bad_edited %>% check_duplicated_relation() %>% try() #> Error in check_duplicated_relation(.) :  #>   Duplicated match of company in loanbook detected. #> Duplicated company name: Peasant Peter, id: 1. #> Duplicated company name: Peasant Peter, id: 2. #> Company names where `accept_match` is `TRUE` must be unique by `id`. #> Have you ensured that only one tilt-id per loanbook-id is set to `TRUE`?  # Bad: Multiple loanbook-companies can't match a single tilt-company bad_edited2 <- demo_matched %>%   filter(id_tilt == 3) %>%   mutate(id = 12) %>%    bind_rows(demo_matched) bad_edited2 %>%    filter(accept_match == TRUE & id_tilt == 3) #> # A tibble: 2 × 13 #>      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷ #>   <dbl> <chr>    <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   <chr>   <chr>   #> 1    12 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan… #> 2     3 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan… #> # … with 3 more variables: string_sim <dbl>, suggest_match <lgl>, #> #   accept_match <lgl>, and abbreviated variable names ¹​company_name, #> #   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt, #> #   ⁷​company_alias_tilt  bad_edited2 %>% check_duplicated_relation() %>% try() #> Error in check_duplicated_relation(.) :  #>   Duplicated match of company from tilt db detected. #> ✖ Duplicated tilt company name: Peasant Peter, tilt id: 3. #> ℹ Have you ensured that each tilt-id is set to `TRUE` for maximum 1 company from the loanbook?"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/articles/tilt-company-match.html","id":"pick-the-matching-companies","dir":"Articles","previous_headings":"3. In R (session 2)","what":"Pick the matching companies","title":"tilt.company.match","text":"edited dataset correct, pick matching companies ’re done. final dataset many rows number TRUE values accept_match columns edited dataset. need use final dataset elsewhere, may write .csv file like :","code":"edited %>% count(accept_match) #> # A tibble: 2 × 2 #>   accept_match     n #>   <lgl>        <int> #> 1 TRUE             4 #> 2 NA              14  final <- edited %>% filter(accept_match) final #> # A tibble: 4 × 13 #>      id compan…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷ #>   <dbl> <chr>    <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   <chr>   <chr>   #> 1     1 Peasant… 01234   germany A       peasan…       1 Peasan… A       peasan… #> 2     2 Peasant… 01234   germany Z       peasan…       2 Peasan… Z       peasan… #> 3     3 Peasant… 11234   germany Z       peasan…       3 Peasan… Z       peasan… #> 4     6 Flower … 34567   germany Z       flower…       7 Flower… F       flower… #> # … with 3 more variables: string_sim <dbl>, suggest_match <lgl>, #> #   accept_match <lgl>, and abbreviated variable names ¹​company_name, #> #   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt, #> #   ⁷​company_alias_tilt # You can install the readr package with: `install.packages(\"readr\")` final %>% readr::write_csv(\"final.csv\")"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Mirja Hollmann. Author, maintainer. Linda Delacombaz. Author.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Hollmann M, Delacombaz L (2023). tilt.company.match: Helpers Company Name Matching tilt-Project. R package version 0.0.0.9000, https://2degreesinvesting.github.io/tilt.company.match/.","code":"@Manual{,   title = {tilt.company.match: Helpers for Company Name Matching in the tilt-Project},   author = {Mirja Hollmann and Linda Delacombaz},   year = {2023},   note = {R package version 0.0.0.9000},   url = {https://2degreesinvesting.github.io/tilt.company.match/}, }"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"tiltcompanymatch","dir":"","previous_headings":"","what":"Helpers for Company Name Matching in the tilt-Project","title":"Helpers for Company Name Matching in the tilt-Project","text":"goal tilt.company.match provide helpers company name matching tilt-project,","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Helpers for Company Name Matching in the tilt-Project","text":"can install development version tilt.company.match GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"2DegreesInvesting/tilt.company.match\")"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"matching-loanbooks-to-the-tilt-database","dir":"","previous_headings":"","what":"Matching loanbooks to the tilt database","title":"Helpers for Company Name Matching in the tilt-Project","text":"matching problem characterised follows: matching companies banks` loanbooks tilt face problems inconsistent company names (typos, conventions…) expected postcode available relatively reliable additional information companies companies loanbooks tilt db (thus match) match companies provided loanbook companies tilt database expect loanbook dataframe tilt db dataframe hold least columns company_name, postcode country column id holding unique row identifiers. columns educate decisions made humans matching process may present. example compare demo data .","code":"library(tilt.company.match) #> Loading required package: stringdist knitr::kable(head(demo_loanbook))"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"pre-matching-functions-to-check-the-data","dir":"","previous_headings":"Matching loanbooks to the tilt database","what":"Pre-matching functions to check the data","title":"Helpers for Company Name Matching in the tilt-Project","text":"order run matching process optimally, useful functions check data matching process.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"check-crucial-columns-names","dir":"","previous_headings":"Matching loanbooks to the tilt database > Pre-matching functions to check the data","what":"Check crucial columns names","title":"Helpers for Company Name Matching in the tilt-Project","text":"crucial right columns’ names loanbook, exactly like demo_loanbook. function check loanbook necessary names, declared “crucial_names”. Now, let us rename loanbook “country” column “countries” “company_name” “Company Name”. un-comment (remove hashtag) line, throws error. error loanbook, can rename loanbook columns, using dplyr::rename() function, perform sanity check just .","code":"loanbook <- demo_loanbook crucial_names <- c(\"id\", \"company_name\", \"postcode\", \"country\") check_crucial_names(loanbook, crucial_names) wrongly_named_loanbook <- loanbook %>%   dplyr::rename(     \"countries\" = \"country\",     \"Company Name\" = \"company_name\"   )  # un-comment this line to have the error # check_crucial_names(wrongly_named_loanbook, crucial_names) corrected_loanbook <- wrongly_named_loanbook %>%   dplyr::rename(     \"country\" = \"countries\",     \"company_name\" = \"Company Name\"   )  check_crucial_names(corrected_loanbook, crucial_names)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"report-duplicates","dir":"","previous_headings":"Matching loanbooks to the tilt database > Pre-matching functions to check the data","what":"Report duplicates","title":"Helpers for Company Name Matching in the tilt-Project","text":"function report_duplicates shows whether duplicates columns interest. case, strongly suggest duplicates company_name, postcode country columns combination. strongly encourage use loanbook data set. Note: example see, duplicate rows columns company_name, postcode, country seem belong different companies need fix loanbook.","code":"loanbook <- demo_loanbook columns <- c(\"company_name\", \"postcode\", \"country\")  report_duplicates(loanbook, columns) #> Found duplicate(s) on columns company_name, postcode, country of the data set. #> ✖ Found for the company Peasant Peter, postcode: 01234, country: germany #> ℹ Please check if these duplicates are intended and have an unique id."},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"report-missing-values","dir":"","previous_headings":"Matching loanbooks to the tilt database > Pre-matching functions to check the data","what":"Report missing values","title":"Helpers for Company Name Matching in the tilt-Project","text":"Missing values NAs ideally loanbook. function abort_if_incomplete() checks many NAs columns data set report user. , loanbook data set NAs. columns (currently id company_name) allow missings. case missings columns report_missings() throw error. removed affected rows data. columns, e.g. postcode missings reported information purposes. However require action user side.","code":"abort_if_incomplete(demo_loanbook) # missings on a non-crucial column missing_non_crucial <- demo_loanbook %>%    dplyr::mutate(postcode = dplyr::if_else(id == 1, NA_character_, .data$postcode))  missing_non_crucial %>%    abort_if_incomplete(non_nullable_cols = c(\"id\", \"company_name\"))  # missings on a crucial column missing_crucial <- demo_loanbook %>%    dplyr::mutate(company_name = dplyr::if_else(id == 1, NA_character_, .data$postcode))  missing_crucial %>%    abort_if_incomplete(non_nullable_cols = c(\"id\", \"company_name\")) #> Error in `abort_if_incomplete()`: #> ! Non-nullable columns must not have `NA`s. #> ✖ Columns to review: company_name"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"preprocessing","dir":"","previous_headings":"Matching loanbooks to the tilt database","what":"Preprocessing","title":"Helpers for Company Name Matching in the tilt-Project","text":"first step, company_names preprocessed reduce noise increase consistency. end use function called to_alias(). assign result preprocessing new column company_alias.","code":"loanbook <- demo_loanbook %>%   dplyr::mutate(company_alias = to_alias(company_name))  knitr::kable(head(loanbook)) tilt <- demo_tilt %>%   dplyr::mutate(company_alias = to_alias(company_name))  knitr::kable(head(tilt))"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"deriving-candidates","dir":"","previous_headings":"Matching loanbooks to the tilt database","what":"Deriving Candidates","title":"Helpers for Company Name Matching in the tilt-Project","text":"identify entries tilt db match companies loanbook, identify first step companies matching country postcode. based assumptions postcodes correct stable. One can see e.g. company loanbook id 1 3 potential matches tilt db postcode (tilt id 1, 2, 4). Next, calculating string similarity aliased company name loanbook aliased company names tilt db postcode ordering descending proximity. complete similarity corresponds 1, complete dissimilarity corresponds 0. several string similarity metrics available stringdist-package. Depending nature generation modality text different metrics perform best. current problem Jaro-Winkler metric prefix factor 0.1 chosen. metric tends suitable comparing human typed text might typos. Based empiric research decided remove match candidates similarity certain threshold. helps drastically reduce number candidates, making data easier process human. Note , rare cases, might loose matches way, since candidates removed due lower threshold longer included matching. concluded improved ease use justifies edgecases. Companies candidates filtering lower threshold reported.","code":"loanbook_with_candidates <- loanbook %>%   dplyr::left_join(tilt, by = c(\"country\", \"postcode\"), suffix = c(\"\", \"_tilt\"))  knitr::kable(head(loanbook_with_candidates)) loanbook_with_candidates_and_dist <- loanbook_with_candidates %>%   dplyr::mutate(string_sim = stringdist::stringsim(a = .data$company_alias, b = .data$company_alias_tilt, method = \"jw\", p = 0.1)) %>%   dplyr::arrange(id, -string_sim)  knitr::kable(loanbook_with_candidates_and_dist) min_threshold <- 0.75  loanbook_with_candidates_and_dist_filtered <- loanbook_with_candidates_and_dist %>%    dplyr::filter(is.na(string_sim) | string_sim > min_threshold) before_filter_id_and_company <- loanbook_with_candidates_and_dist %>%    dplyr::select(id, company_name) %>%    dplyr::distinct_all()  after_filter_id_and_company <- loanbook_with_candidates_and_dist_filtered %>%    dplyr::select(id, company_name) %>%    dplyr::distinct_all()  lost_companies <- before_filter_id_and_company %>%    dplyr::anti_join(after_filter_id_and_company) #> Joining, by = c(\"id\", \"company_name\")  knitr::kable(lost_companies)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"selecting-matches","dir":"","previous_headings":"","what":"Selecting matches","title":"Helpers for Company Name Matching in the tilt-Project","text":"order make work human working matching easy possible can automated automated. However correct matching essential project success incorrect matches, ultimately ruled matching automatically acceptable. consequence now following workflow suggested. human coder inspect data. advisable spreadsheet application. row selected match setting column accept_match TRUE. support column suggest_match provided. suggest_match column set TRUE : match determined threshold. highest match matches. 1 highest match per company_name x id combination avoid duplicates. Notes: Even match 1 postcode can rare cases False positive, compare e.g. company 4 (“Peasant Paul”) example data. want automatically approve unique matches may cases multiple companies ZIP code name. cases, additional information (example, sector, street name, main activity etc.) can help make final decision.","code":"highest_matches_per_company <- loanbook_with_candidates_and_dist_filtered %>%   dplyr::group_by(id) %>%   dplyr::filter(string_sim == max(string_sim))  threshold <- 0.9 # Threshold decided upon extensive experience with r2dii.match function and processes  highest_matches_per_company_above_thresh <- highest_matches_per_company %>%   dplyr::filter(string_sim > threshold)  highest_matches_per_company_above_thresh_wo_duplicates <- highest_matches_per_company_above_thresh %>%   dplyr::mutate(duplicates = any(duplicated(company_name, postcode))) %>%   dplyr::filter(duplicates == FALSE) %>%   dplyr::select(id, id_tilt) %>%   dplyr::mutate(suggest_match = TRUE)  loanbook_with_candidates_and_dist_and_suggestion <- loanbook_with_candidates_and_dist_filtered %>%   dplyr::left_join(highest_matches_per_company_above_thresh_wo_duplicates, by = c(\"id\", \"id_tilt\")) %>%   dplyr::mutate(accept_match = NA)  knitr::kable(loanbook_with_candidates_and_dist_and_suggestion)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"check-matching-process","dir":"","previous_headings":"Selecting matches","what":"Check matching process","title":"Helpers for Company Name Matching in the tilt-Project","text":"matched manually companies, can check companies matched loanbook. can used ‘double-check’ see two data sets correctly manually matched. demo-matched data set example data set look like manually checked: accept_match column now changed TRUE NA, depending whether company matched .","code":"manually_matched <- demo_matched  knitr::kable(manually_matched)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"report-companies-with-no-matches","dir":"","previous_headings":"Selecting matches","what":"Report companies with no matches","title":"Helpers for Company Name Matching in the tilt-Project","text":"can use report_no_matches function determine companies loanbook match selected found.","code":"not_matched <- report_no_matches(loanbook, manually_matched) #> Joining, by = c(\"id\", \"company_name\", \"postcode\", \"country\", \"misc_info\", #> \"company_alias\") #> Companies not matched in the loanbook by the tilt data set: Peasant Paul Bread #> Bakers Limited Screwdriver Experts Screwdriver Expert John Meier's Groceries #> John Meier's Groceries John Meier's Groceries Best Bakers ℹ Did you match these #> companies manually correctly ?  knitr::kable(not_matched)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/index.html","id":"report-duplicate-matches","dir":"","previous_headings":"Selecting matches","what":"Report duplicate matches","title":"Helpers for Company Name Matching in the tilt-Project","text":"check manual errors manual matching process, can use check_duplicated_relation function. checks company loanbook matched > 1 company tilt dataset reverse. , demo_matched data set hand-matched correctly: column accept_match manually changed verified. function throw error inform duplicates found. Now let us insert duplicated matches company ids 1 2. function abort throws error lines duplicated rows. Also, error thrown insert duplicate match company tilt db loanbook.","code":"manually_matched <- demo_matched  knitr::kable(manually_matched) check_duplicated_relation(manually_matched) #> No duplicated matches found in the data. duplicate_in_loanbook <- manually_matched %>%   dplyr::mutate(accept_match = dplyr::if_else(id %in% c(1, 2), TRUE, accept_match))  knitr::kable(duplicate_in_loanbook %>% dplyr::filter(id %in% c(1, 2))) # un-comment this line to have the error # check_duplicated_relation(duplicate_in_loanbook) duplicate_tilt_id_row <- demo_matched %>%   dplyr::filter(id_tilt == 3) %>%   dplyr::mutate(id = 12) duplicate_tilt_id <- dplyr::bind_rows(demo_matched, duplicate_tilt_id_row)  knitr::kable(duplicate_tilt_id %>% dplyr::filter(accept_match == TRUE & id_tilt == 3)) # un-comment this line to have the error # check_duplicated_relation(duplicate_tilt_id)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/abort_if_incomplete.html","id":null,"dir":"Reference","previous_headings":"","what":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","title":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","text":"Aborts data missing values non-nullable columns","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/abort_if_incomplete.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","text":"","code":"abort_if_incomplete(data, non_nullable_cols = names(data))"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/abort_if_incomplete.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","text":"data Tibble holding result data set. non_nullable_cols character vector holding names columns NAs allowed.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/abort_if_incomplete.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","text":"Input data invisibly.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/abort_if_incomplete.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aborts when data has missing values on non-nullable columns — abort_if_incomplete","text":"","code":"data <- tibble::tibble(x = NA, y = 1, z = NA)  # With NA in nullable columns returns data invisibly data %>% abort_if_incomplete(non_nullable_cols = \"y\") out <- data %>% abort_if_incomplete(non_nullable_cols = \"y\") identical(out, data) #> [1] TRUE  # With NA in one nullable column, alerts the column to review as an error data %>% abort_if_incomplete(non_nullable_cols = c(\"x\", \"y\")) %>% try() #> Error in abort_if_incomplete(., non_nullable_cols = c(\"x\", \"y\")) :  #>   Non-nullable columns must not have `NA`s. #> ✖ Columns to review: x  # By default, it takes all columns as non-nullable data %>% abort_if_incomplete() %>% try() #> Error in abort_if_incomplete(.) :  #>   Non-nullable columns must not have `NA`s. #> ✖ Columns to review: x, z"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_crucial_names.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if a named object contains expected names — check_crucial_names","title":"Check if a named object contains expected names — check_crucial_names","text":"Based fgeo.tool::check_crucial_names()","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_crucial_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if a named object contains expected names — check_crucial_names","text":"","code":"check_crucial_names(x, expected_names)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_crucial_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if a named object contains expected names — check_crucial_names","text":"x named object. expected_names String; expected names x.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_crucial_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if a named object contains expected names — check_crucial_names","text":"Invisible x, error informative message. Adapted : https://github.com/RMI-PACTA/r2dii.match/blob/main/R/check_crucial_names.R","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_crucial_names.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check if a named object contains expected names — check_crucial_names","text":"","code":"x <- c(a = 1) check_crucial_names(x, \"a\") try(check_crucial_names(x, \"bad\")) #> Error in abort_missing_names(sort(setdiff(expected_names, names(x)))) :  #>   Must have missing names: #> `bad`"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_duplicated_relation.html","id":null,"dir":"Reference","previous_headings":"","what":"Reports duplicates from manual matching outcome — check_duplicated_relation","title":"Reports duplicates from manual matching outcome — check_duplicated_relation","text":"Function throws descriptive error company loanbook matched > 1 company tilt db reverse.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_duplicated_relation.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Reports duplicates from manual matching outcome — check_duplicated_relation","text":"","code":"check_duplicated_relation(manually_matched)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_duplicated_relation.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Reports duplicates from manual matching outcome — check_duplicated_relation","text":"manually_matched Tibble holding result matching process, user manually verified matched results","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/check_duplicated_relation.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Reports duplicates from manual matching outcome — check_duplicated_relation","text":"Input manually_matched","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_loanbook.html","id":null,"dir":"Reference","previous_headings":"","what":"Demo loanbook entries — demo_loanbook","title":"Demo loanbook entries — demo_loanbook","text":"simplified demo tilt company data set illustrate test matching loanbook. details included cases please refer data generation script.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_loanbook.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Demo loanbook entries — demo_loanbook","text":"","code":"demo_loanbook"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_loanbook.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Demo loanbook entries — demo_loanbook","text":"tibble 11 rows 5 variables: id numeric id company_name name company postcode postcode company country country name lowercase misc_info placeholder column holds additional information human matchers consider matching","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_loanbook.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Demo loanbook entries — demo_loanbook","text":"","code":"demo_loanbook #> # A tibble: 12 × 5 #>       id company_name           postcode country misc_info #>    <dbl> <chr>                  <chr>    <chr>   <chr>     #>  1     1 Peasant Peter          01234    germany A         #>  2     2 Peasant Peter          01234    germany Z         #>  3     3 Peasant Peter          11234    germany Z         #>  4     4 Peasant Paul           01234    germany Z         #>  5     5 Bread Bakers Limited   23456    germany C         #>  6     6 Flower Power & Company 34567    germany Z         #>  7     7 Screwdriver Experts    45678    germany D         #>  8     8 Screwdriver Expert     45678    germany Z         #>  9     9 John Meier's Groceries 56789    germany E         #> 10    10 John Meier's Groceries 55555    germany Y         #> 11    11 John Meier's Groceries 55555    norway  Y         #> 12    12 Best Bakers            65656    france  F"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_matched.html","id":null,"dir":"Reference","previous_headings":"","what":"Demo matched db entries — demo_matched","title":"Demo matched db entries — demo_matched","text":"simplified demo matched company data set illustrate manual matching process loanbook. details included cases please refer data generation script.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_matched.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Demo matched db entries — demo_matched","text":"","code":"demo_matched"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_matched.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Demo matched db entries — demo_matched","text":"tibble 9 rows 5 variables: id numeric id company_name name company postcode postcode company country country name lowercase misc_info placeholder column holds additional information human matchers consider matching company_alias name company, preprocessed id_tilt numeric id tilt db company_name_tilt name company misc_info_tilt placeholder column holds additional information human matchers consider matching company_alias_tilt name company, preprocessed string_sim string similarity aliased company name loanbook aliase company name tilt db suggest_match set TRUE string_sim certain threshold accept_match manual decision whether company loanbook matches comapny tilt db","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_matched.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Demo matched db entries — demo_matched","text":"","code":"demo_matched #> # A tibble: 18 × 13 #>       id compa…¹ postc…² country misc_…³ compa…⁴ id_tilt compa…⁵ misc_…⁶ compa…⁷ #>    <dbl> <chr>   <chr>   <chr>   <chr>   <chr>     <dbl> <chr>   <chr>   <chr>   #>  1     1 Peasan… 01234   germany A       peasan…       1 Peasan… A       peasan… #>  2     1 Peasan… 01234   germany A       peasan…       2 Peasan… Z       peasan… #>  3     1 Peasan… 01234   germany A       peasan…       4 Peasan… B       peasan… #>  4     2 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan… #>  5     2 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan… #>  6     2 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan… #>  7     3 Peasan… 11234   germany Z       peasan…       3 Peasan… Z       peasan… #>  8     4 Peasan… 01234   germany Z       peasan…       4 Peasan… B       peasan… #>  9     4 Peasan… 01234   germany Z       peasan…       1 Peasan… A       peasan… #> 10     4 Peasan… 01234   germany Z       peasan…       2 Peasan… Z       peasan… #> 11     5 Bread … 23456   germany C       breadb…       5 The Br… C       thebre… #> 12     6 Flower… 34567   germany Z       flower…       7 Flower… F       flower… #> 13     6 Flower… 34567   germany Z       flower…       6 Flower… D       flower… #> 14     7 Screwd… 45678   germany D       screwd…      NA NA      NA      NA      #> 15     8 Screwd… 45678   germany Z       screwd…      NA NA      NA      NA      #> 16     9 John M… 56789   germany E       johnme…       8 John a… E       johnja… #> 17    10 John M… 55555   germany Y       johnme…      NA NA      NA      NA      #> 18    11 John M… 55555   norway  Y       johnme…      NA NA      NA      NA      #> # … with 3 more variables: string_sim <dbl>, suggest_match <lgl>, #> #   accept_match <lgl>, and abbreviated variable names ¹​company_name, #> #   ²​postcode, ³​misc_info, ⁴​company_alias, ⁵​company_name_tilt, ⁶​misc_info_tilt, #> #   ⁷​company_alias_tilt"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_tilt.html","id":null,"dir":"Reference","previous_headings":"","what":"Demo tilt db entries — demo_tilt","title":"Demo tilt db entries — demo_tilt","text":"simplified demo tilt company data set illustrate test matching loanbook. details included cases please refer data generation script.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_tilt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Demo tilt db entries — demo_tilt","text":"","code":"demo_tilt"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_tilt.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Demo tilt db entries — demo_tilt","text":"tibble 9 rows 5 variables: id numeric id company_name name company postcode postcode company country country name lowercase misc_info placeholder column holds additional information human matchers consider matching","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/demo_tilt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Demo tilt db entries — demo_tilt","text":"","code":"demo_tilt #> # A tibble: 11 × 5 #>       id company_name                 postcode country misc_info #>    <dbl> <chr>                        <chr>    <chr>   <chr>     #>  1     1 Peasant Peter                01234    germany A         #>  2     2 Peasant Peter                01234    germany Z         #>  3     3 Peasant Peter                11234    germany Z         #>  4     4 Peasant Paul                 01234    germany B         #>  5     5 The Bread Bakers Ltd         23456    germany C         #>  6     6 Flower Power Friends and Co. 34567    germany D         #>  7     7 Flower Power and Co.         34567    germany F         #>  8     8 John and Jacques Groceries   56789    germany E         #>  9     9 John and Jacques Groceries   98765    germany E         #> 10    10 John and Jacques Groceries   98765    france  E         #> 11    11 Cranes and Friends           65656    france  F"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/from_name_to_alias.html","id":null,"dir":"Reference","previous_headings":"","what":"From name to alias — from_name_to_alias","title":"From name to alias — from_name_to_alias","text":"Function outputs table giving default strings used convert name alias. may amend table pass to_alias() via from_to argument.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/from_name_to_alias.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"From name to alias — from_name_to_alias","text":"","code":"from_name_to_alias()"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/from_name_to_alias.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"From name to alias — from_name_to_alias","text":"tibble::tibble columns .","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/from_name_to_alias.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"From name to alias — from_name_to_alias","text":"Source: @jdhoffa https://github.com/RMI-PACTA/r2dii.dataraw/pull/8","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/pipe.html","id":null,"dir":"Reference","previous_headings":"","what":"Pipe operator — %>%","title":"Pipe operator — %>%","text":"See magrittr::%>% details.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/pipe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Pipe operator — %>%","text":"","code":"lhs %>% rhs"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/pipe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pipe operator — %>%","text":"lhs value magrittr placeholder. rhs function call using magrittr semantics.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/pipe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pipe operator — %>%","text":"result calling rhs(lhs).","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_duplicates.html","id":null,"dir":"Reference","previous_headings":"","what":"Report duplicate rows — report_duplicates","title":"Report duplicate rows — report_duplicates","text":"Reports duplicates data columns cols. specifically, interested case company_name, postcode country columns. Duplicates reported via warning.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_duplicates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Report duplicate rows — report_duplicates","text":"","code":"report_duplicates(data, cols)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_duplicates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Report duplicate rows — report_duplicates","text":"data Tibble holding result data set. cols Vector columns names want test duplicates .","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_no_matches.html","id":null,"dir":"Reference","previous_headings":"","what":"Reports companies that were not matched in the loanbook — report_no_matches","title":"Reports companies that were not matched in the loanbook — report_no_matches","text":"Reports companies matched loanbook","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_no_matches.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Reports companies that were not matched in the loanbook — report_no_matches","text":"","code":"report_no_matches(loanbook, manually_matched)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_no_matches.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Reports companies that were not matched in the loanbook — report_no_matches","text":"loanbook Loanbook data set manually_matched Tibble holding result matching process, user manually selected matched companies loanbook tilt data set.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/report_no_matches.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Reports companies that were not matched in the loanbook — report_no_matches","text":"not_matched_companies Tibble holding id company name companies matched tilt data set.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/tilt.company.match-package.html","id":null,"dir":"Reference","previous_headings":"","what":"tilt.company.match: Helpers for Company Name Matching in the tilt-Project — tilt.company.match-package","title":"tilt.company.match: Helpers for Company Name Matching in the tilt-Project — tilt.company.match-package","text":"Package holds helpers company matching tilt-project. details please refer README.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/tilt.company.match-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"tilt.company.match: Helpers for Company Name Matching in the tilt-Project — tilt.company.match-package","text":"Maintainer: Mirja Hollmann mirja@2degrees-investing.org Authors: Linda Delacombaz linda@2degrees-investing.org","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":null,"dir":"Reference","previous_headings":"","what":"Assign an additional name to an entity — to_alias","title":"Assign an additional name to an entity — to_alias","text":"to_alias() takes character vector creates alias transforming input () lower case; (b) latin-ascii characters; (c) standard abbreviations ownership types. Commonly, inputs values columns name_direct_loantaker name_ultimate_parent loanbook dataset, column name_company asset-level dataset. from_name_to_alias() outputs table giving default strings used convert name alias. may amend table pass to_alias() via from_to argument.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Assign an additional name to an entity — to_alias","text":"","code":"to_alias(x, from_to = NULL, ownership = NULL, remove_ownership = FALSE)"},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Assign an additional name to an entity — to_alias","text":"r2dii.match version 0.1.3.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Assign an additional name to an entity — to_alias","text":"x Character string, commonly columns name_direct_loantaker name_ultimate_parent loanbook dataset, column name_company asset-level dataset. from_to data frame replacement rules applied, contains columns (initial values) (resulting values). ownership vector company ownership types distinguished cut-separation. remove_ownership Flag defines whether ownership type (like llc) cut-.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Assign an additional name to an entity — to_alias","text":"to_alias() returns character string. from_name_to_alias() returns tibble::tibble columns .","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"assigning-aliases","dir":"Reference","previous_headings":"","what":"Assigning aliases","title":"Assign an additional name to an entity — to_alias","text":"transformation process used compare names loanbook tilt datasets applies best practices commonly used name matching algorithms: Remove special characters. Replace language specific characters. Abbreviate certain names reduce importance matching. Spell numbers increase importance.","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Assign an additional name to an entity — to_alias","text":"person(given = \"Evgeny\", family = \"Petrovsky\", role = c(\"aut\", \"ctr\")) Adapted : https://github.com/RMI-PACTA/r2dii.match/blob/main/R/to_alias.R","code":""},{"path":"https://2degreesinvesting.github.io/tilt.company.match/reference/to_alias.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Assign an additional name to an entity — to_alias","text":"","code":"library(dplyr) #>  #> Attaching package: ‘dplyr’ #> The following objects are masked from ‘package:stats’: #>  #>     filter, lag #> The following objects are masked from ‘package:base’: #>  #>     intersect, setdiff, setequal, union  to_alias(\"A. and B\") #> [1] \"ab\" to_alias(\"Acuity Brands Inc\") #> [1] \"acuitybrands inc\" to_alias(c(\"3M Company\", \"Abbott Laboratories\", \"AbbVie Inc.\")) #> [1] \"threem co\"          \"abbottlaboratories\" \"abbvie inc\"          custom_replacement <- tibble(from = \"AAAA\", to = \"B\") to_alias(\"Aa Aaaa\", from_to = custom_replacement) #> [1] \"aab\"  neutral_replacement <- tibble(from = character(0), to = character(0)) to_alias(\"Company Name Owner\", from_to = neutral_replacement) #> [1] \"companynameowner\" to_alias(   \"Company Name Owner\",   from_to = neutral_replacement,   ownership = \"owner\",   remove_ownership = TRUE ) #> [1] \"companyname\"  from_name_to_alias() #> # A tibble: 61 × 2 #>    from     to     #>    <chr>    <chr>  #>  1 \" and \"  \" & \"  #>  2 \" en \"   \" & \"  #>  3 \" och \"  \" & \"  #>  4 \" und \"  \" & \"  #>  5 \"(pjsc)\" \"\"     #>  6 \"(pte)\"  \"\"     #>  7 \"(pvt)\"  \"\"     #>  8 \"0\"      \"null\" #>  9 \"1\"      \"one\"  #> 10 \"2\"      \"two\"  #> # … with 51 more rows  append_replacements <- from_name_to_alias() %>%   add_row(     .before = 1,     from = c(\"AA\", \"BB\"), to = c(\"alpha\", \"beta\")   ) append_replacements #> # A tibble: 63 × 2 #>    from     to      #>    <chr>    <chr>   #>  1 \"AA\"     \"alpha\" #>  2 \"BB\"     \"beta\"  #>  3 \" and \"  \" & \"   #>  4 \" en \"   \" & \"   #>  5 \" och \"  \" & \"   #>  6 \" und \"  \" & \"   #>  7 \"(pjsc)\" \"\"      #>  8 \"(pte)\"  \"\"      #>  9 \"(pvt)\"  \"\"      #> 10 \"0\"      \"null\"  #> # … with 53 more rows  # And in combination with `to_alias()` to_alias(c(\"AA\", \"BB\", \"1\"), from_to = append_replacements) #> [1] \"alpha\" \"beta\"  \"one\""}]
